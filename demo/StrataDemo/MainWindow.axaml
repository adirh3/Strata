<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="using:StrataDemo"
        xmlns:sc="using:StrataTheme.Controls"
        x:Class="StrataDemo.MainWindow"
  x:CompileBindings="False"
        Title="{Binding Strings[AppTitle]}"
        FlowDirection="{Binding Strings.FlowDirection}"
        Width="1280" Height="860"
          MinWidth="760" MinHeight="560"
        WindowStartupLocation="CenterScreen">

  <Window.DataContext>
    <local:MainViewModel />
  </Window.DataContext>

  <Window.Styles>
    <Style Selector="StackPanel.page-shell, Grid.page-shell">
      <Setter Property="Margin" Value="32,24,32,28" />
    </Style>
    <Style Selector="Window.compact StackPanel.page-shell, Window.compact Grid.page-shell">
      <Setter Property="Margin" Value="20,16,20,20" />
    </Style>
    <Style Selector="Window.narrow StackPanel.page-shell, Window.narrow Grid.page-shell">
      <Setter Property="Margin" Value="12,10,12,12" />
    </Style>

    <Style Selector="Window.compact Border#SidebarRoot">
      <Setter Property="Width" Value="220" />
    </Style>
    <Style Selector="Window.narrow Border#SidebarRoot">
      <Setter Property="Width" Value="188" />
    </Style>

  </Window.Styles>

  <DockPanel>

    <!-- ═══════════════════ LEFT SIDEBAR ═══════════════════ -->
    <Border x:Name="SidebarRoot"
            DockPanel.Dock="Left"
            Width="248"
            Background="{DynamicResource Brush.Surface0}"
            BorderBrush="{DynamicResource Brush.BorderSubtle}"
            BorderThickness="0,0,1,0">
      <DockPanel>

        <!-- Brand header -->
        <Border DockPanel.Dock="Top">
          <StackPanel>
            <Border Height="3" Background="{DynamicResource Brush.StratumLine}" />
            <StackPanel Margin="20,20,20,18" Spacing="2">
              <StackPanel Orientation="Horizontal" Spacing="12">
                <Border Width="36" Height="36"
                        CornerRadius="10"
                        Background="{DynamicResource Brush.AccentGradient}">
                  <TextBlock Text="S" FontSize="18" FontWeight="Bold"
                             Foreground="{DynamicResource Brush.TextOnAccent}"
                             HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <StackPanel VerticalAlignment="Center" Spacing="1">
                  <TextBlock Text="Strata" FontSize="18" FontWeight="SemiBold" />
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.TextTertiary}"
                             Text="{Binding Strings[DesignSystem]}" FontWeight="Medium" />
                </StackPanel>
              </StackPanel>
            </StackPanel>
            <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Margin="20,0" />
          </StackPanel>
        </Border>

        <!-- Bottom: Theme controls -->
        <StackPanel DockPanel.Dock="Bottom" Margin="20,12,20,20" Spacing="6">
          <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Margin="0,0,0,6" />
          <ToggleSwitch Content="{Binding Strings[DarkMode]}"
                        IsChecked="{Binding IsDarkTheme}"
                        x:Name="ThemeToggle" />
          <ToggleSwitch Content="{Binding Strings[Compact]}"
                        IsChecked="{Binding IsCompactDensity}"
                        x:Name="DensityToggle" />
        </StackPanel>

        <!-- Navigation list -->
        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
          <StackPanel Margin="12,16,12,0" Spacing="1">
            <TextBlock Classes="caption" Text="{Binding Strings[Pages]}" Margin="12,4,0,10"
                       FontWeight="SemiBold" Foreground="{DynamicResource Brush.TextTertiary}"
                       LetterSpacing="1.2" FontSize="10" />
            <ListBox x:Name="NavList"
                     SelectedIndex="{Binding SelectedNavIndex}"
                     BorderThickness="0"
                     Background="Transparent"
                     Padding="0">
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x25A3;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.Dashboard]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x2630;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.FormControls]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x229E;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.DataGrid]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x25C7;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.Components]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x25C8;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.UxControls]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x2726;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.AiControls]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x2699;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.Settings]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
              <ListBoxItem>
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="&#x1F5E8;" FontSize="15" Width="18" TextAlignment="Center"
                             Foreground="{DynamicResource Brush.TextTertiary}" VerticalAlignment="Center" />
                  <TextBlock Text="{Binding Strings[Nav.ChatExperience]}" FontWeight="Medium" VerticalAlignment="Center" />
                </StackPanel>
              </ListBoxItem>
            </ListBox>
          </StackPanel>
        </ScrollViewer>
      </DockPanel>
    </Border>

    <!-- ═══════════════════ MAIN CONTENT ═══════════════════ -->
    <Panel x:Name="PageHost" Background="{DynamicResource Brush.Background}">

      <!-- ════════ Page 0: Dashboard ════════ -->
      <ScrollViewer x:Name="Page0"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="True">
        <StackPanel Classes="page-shell" Spacing="32" MaxWidth="920">

          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="headline" Text="{Binding Strings[Dashboard]}" />
              <TextBlock Classes="secondary" Text="{Binding Strings[Dashboard.Subtitle]}" />
            </StackPanel>
          </Border>

          <!-- Stat cards -->
          <Grid x:Name="DashboardCardsGrid" ColumnDefinitions="*,16,*,16,*">
            <Border Grid.Column="0" Classes="strata-card" Padding="0" ClipToBounds="True"
                    ToolTip.Tip="Revenue for the current billing period">
              <DockPanel>
                <Border DockPanel.Dock="Top" Height="2.5" Background="{DynamicResource Brush.StratumLine}" />
                <StackPanel Spacing="6" Margin="20,16,20,18">
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.AccentDefault}" Text="{Binding Strings[TotalRevenue]}" FontWeight="SemiBold" LetterSpacing="0.5" />
                  <TextBlock FontSize="28" FontWeight="SemiBold" Text="$84,250" Margin="0,2,0,0" />
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.SuccessDefault}" Text="{Binding Strings[RevenueUp]}" />
                </StackPanel>
              </DockPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card" Padding="0" ClipToBounds="True"
                    ToolTip.Tip="Active clients across all projects">
              <DockPanel>
                <Border DockPanel.Dock="Top" Height="2.5" Background="{DynamicResource Brush.StratumLine}" />
                <StackPanel Spacing="6" Margin="20,16,20,18">
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.AccentDefault}" Text="{Binding Strings[ActiveClients]}" FontWeight="SemiBold" LetterSpacing="0.5" />
                  <TextBlock FontSize="28" FontWeight="SemiBold" Text="38" Margin="0,2,0,0" />
                  <TextBlock Classes="caption secondary" Text="{Binding Strings[NewThisWeek]}" />
                </StackPanel>
              </DockPanel>
            </Border>
            <Border Grid.Column="4" Classes="strata-card" Padding="0" ClipToBounds="True"
                    ToolTip.Tip="Overall project completion rate">
              <DockPanel>
                <Border DockPanel.Dock="Top" Height="2.5" Background="{DynamicResource Brush.StratumLine}" />
                <StackPanel Spacing="6" Margin="20,16,20,18">
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.AccentDefault}" Text="{Binding Strings[Completion]}" FontWeight="SemiBold" LetterSpacing="0.5" />
                  <TextBlock FontSize="28" FontWeight="SemiBold" Text="{Binding ProgressValue, StringFormat='{}{0:F0}%'}" Margin="0,2,0,0" />
                  <ProgressBar Minimum="0" Maximum="100" Value="{Binding ProgressValue}" Margin="0,2,0,0" />
                </StackPanel>
              </DockPanel>
            </Border>
          </Grid>

          <!-- Charts -->
          <Grid ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card">
              <StackPanel Spacing="12">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="{Binding Strings[Chart.Revenue]}" />
                  <TextBlock Classes="caption tertiary" Text="{Binding Strings[Chart.Revenue.Subtitle]}" />
                </StackPanel>
                <sc:StrataChart ChartType="Line" ChartHeight="200"
                                Labels="{Binding ChartMonthLabels}"
                                Series="{Binding RevenueSeries}" />
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card">
              <StackPanel Spacing="12">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="{Binding Strings[Chart.Budget]}" />
                  <TextBlock Classes="caption tertiary" Text="{Binding Strings[Chart.Budget.Subtitle]}" />
                </StackPanel>
                <sc:StrataChart ChartType="Bar" ChartHeight="200"
                                Labels="{Binding DeptLabels}"
                                Series="{Binding DeptSeries}" />
              </StackPanel>
            </Border>
          </Grid>

          <Grid ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card">
              <StackPanel Spacing="12">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="{Binding Strings[Chart.Distribution]}" />
                  <TextBlock Classes="caption tertiary" Text="{Binding Strings[Chart.Distribution.Subtitle]}" />
                </StackPanel>
                <sc:StrataChart ChartType="Donut" ChartHeight="220"
                                Labels="{Binding ProjectLabels}"
                                Series="{Binding ProjectSeries}"
                                DonutCenterValue="100%"
                                DonutCenterLabel="Allocation" />
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card">
              <StackPanel Spacing="12">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="{Binding Strings[Chart.Clients]}" />
                  <TextBlock Classes="caption tertiary" Text="{Binding Strings[Chart.Clients.Subtitle]}" />
                </StackPanel>
                <sc:StrataChart ChartType="Pie" ChartHeight="220"
                                Labels="{Binding ClientLabels}"
                                Series="{Binding ClientSeries}" />
              </StackPanel>
            </Border>
          </Grid>

          <!-- Type scale -->
          <Border Classes="strata-card">
            <StackPanel Spacing="8">
              <TextBlock Classes="subtitle" Text="{Binding Strings[TypeScale]}" Margin="0,0,0,6" />
              <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Margin="0,0,0,4" />
              <TextBlock Classes="display" Text="Display — 32px" />
              <TextBlock Classes="headline" Text="Headline — 24px" />
              <TextBlock Classes="title" Text="Title — 20px" />
              <TextBlock Classes="subtitle" Text="Subtitle — 16px" />
              <TextBlock Classes="body-strong" Text="Body Strong — 14px SemiBold" />
              <TextBlock Text="Body — 14px" />
              <TextBlock Classes="caption" Text="Caption — 12px" />
            </StackPanel>
          </Border>

          <!-- Buttons -->
          <Border Classes="strata-card">
            <StackPanel Spacing="16">
              <StackPanel Spacing="2">
                <TextBlock Classes="subtitle" Text="{Binding Strings[Buttons]}" />
                <TextBlock Classes="caption tertiary" Text="{Binding Strings[Buttons.Subtitle]}" />
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Classes="accent" Content="{Binding Strings[Primary]}" ToolTip.Tip="High-emphasis primary action" />
                <Button Content="{Binding Strings[Default]}" ToolTip.Tip="Standard secondary action" />
                <Button Classes="subtle" Content="{Binding Strings[Subtle]}" ToolTip.Tip="Low-emphasis inline action" />
                <Button Classes="danger" Content="{Binding Strings[Delete]}" ToolTip.Tip="Destructive action" />
                <Button Content="{Binding Strings[Disabled]}" IsEnabled="False" />
              </StackPanel>
            </StackPanel>
          </Border>
        </StackPanel>
      </ScrollViewer>

      <!-- ════════ Page 1: Forms ════════ -->
      <ScrollViewer x:Name="Page1"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="False">
        <StackPanel Classes="page-shell" Spacing="32" MaxWidth="920">

          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="headline" Text="{Binding Strings[FormControls]}" />
              <TextBlock Classes="secondary" Text="{Binding Strings[FormControls.Subtitle]}" />
            </StackPanel>
          </Border>

          <Border Classes="strata-card">
            <StackPanel Spacing="16">
              <StackPanel Spacing="2">
                <TextBlock Classes="subtitle" Text="{Binding Strings[TextInput]}" />
                <TextBlock Classes="caption tertiary" Text="{Binding Strings[TextInput.Subtitle]}" />
              </StackPanel>
              <Grid x:Name="FormTextGrid" ColumnDefinitions="*,24,*">
                <StackPanel Grid.Column="0" Spacing="6">
                  <TextBlock Classes="caption" FontWeight="Medium" Text="{Binding Strings[FullName]}" />
                  <TextBox Watermark="{Binding Strings[EnterYourName]}" Text="{Binding SampleText}" />
                </StackPanel>
                <StackPanel Grid.Column="2" Spacing="6">
                  <TextBlock Classes="caption" FontWeight="Medium" Text="{Binding Strings[EmailDisabled]}" />
                  <TextBox Watermark="{Binding Strings[DisabledInput]}" IsEnabled="False" Text="user@example.com" />
                </StackPanel>
              </Grid>
            </StackPanel>
          </Border>

          <Border Classes="strata-card">
            <StackPanel Spacing="16">
              <StackPanel Spacing="2">
                <TextBlock Classes="subtitle" Text="{Binding Strings[Selection]}" />
                <TextBlock Classes="caption tertiary" Text="{Binding Strings[Selection.Subtitle]}" />
              </StackPanel>
              <Grid x:Name="FormSelectionGrid" ColumnDefinitions="*,24,*">
                <StackPanel Grid.Column="0" Spacing="6">
                  <TextBlock Classes="caption" FontWeight="Medium" Text="{Binding Strings[Region]}" />
                  <ComboBox ItemsSource="{Binding ComboItems}"
                            SelectedIndex="0"
                            PlaceholderText="{Binding Strings[ChooseOption]}"
                            HorizontalAlignment="Stretch" />
                </StackPanel>
                <StackPanel Grid.Column="2" Spacing="6">
                  <TextBlock Classes="caption" FontWeight="Medium" Text="{Binding Strings[Volume]}" />
                  <Slider Minimum="0" Maximum="100" Value="{Binding SliderValue}" />
                  <TextBlock Classes="caption tertiary" Text="{Binding SliderValue, StringFormat='Value: {0:F0}'}" />
                </StackPanel>
              </Grid>
            </StackPanel>
          </Border>

          <Grid x:Name="FormChecksGrid" ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card">
              <StackPanel Spacing="14">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="CheckBox" />
                  <TextBlock Classes="caption tertiary" Text="Binary and tri-state toggles." />
                </StackPanel>
                <StackPanel Spacing="8">
                  <CheckBox Content="{Binding Strings[EnableNotifications]}" IsChecked="True" />
                  <CheckBox Content="{Binding Strings[AutoSaveDrafts]}" />
                  <CheckBox Content="{Binding Strings[Indeterminate]}" IsThreeState="True" IsChecked="{x:Null}" />
                </StackPanel>
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card">
              <StackPanel Spacing="14">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="RadioButton" />
                  <TextBlock Classes="caption tertiary" Text="Mutually exclusive single-select." />
                </StackPanel>
                <StackPanel Spacing="8">
                  <RadioButton Content="{Binding Strings[Small]}" GroupName="Size" IsChecked="True" />
                  <RadioButton Content="{Binding Strings[Medium]}" GroupName="Size" />
                  <RadioButton Content="{Binding Strings[Large]}" GroupName="Size" />
                </StackPanel>
              </StackPanel>
            </Border>
          </Grid>

          <Grid x:Name="FormToggleGrid" ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card">
              <StackPanel Spacing="14">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="ToggleSwitch" />
                  <TextBlock Classes="caption tertiary" Text="On/off switches for boolean settings." />
                </StackPanel>
                <StackPanel Spacing="8">
                  <ToggleSwitch Content="{Binding Strings[WiFi]}" IsChecked="True" />
                  <ToggleSwitch Content="{Binding Strings[Bluetooth]}" />
                  <ToggleSwitch Content="{Binding Strings[Disabled]}" IsEnabled="False" />
                </StackPanel>
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card">
              <StackPanel Spacing="14">
                <StackPanel Spacing="2">
                  <TextBlock Classes="subtitle" Text="Progress" />
                  <TextBlock Classes="caption tertiary" Text="Track and visualize completion." />
                </StackPanel>
                <StackPanel Spacing="12">
                  <ProgressBar Minimum="0" Maximum="100" Value="{Binding ProgressValue}" />
                  <TextBlock Classes="caption tertiary"
                             Text="{Binding ProgressValue, StringFormat='{}{0}% complete'}" />
                  <Slider Minimum="0" Maximum="100" Value="{Binding ProgressValue}" />
                </StackPanel>
              </StackPanel>
            </Border>
          </Grid>
        </StackPanel>
      </ScrollViewer>

      <!-- ════════ Page 2: Data Grid ════════ -->
      <ScrollViewer x:Name="Page2"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="False">
        <StackPanel Classes="page-shell" Spacing="32" MaxWidth="920">

          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="headline" Text="{Binding Strings[DataGrid]}" />
              <TextBlock Classes="secondary" Text="{Binding Strings[DataGrid.Subtitle]}" />
            </StackPanel>
          </Border>

          <DataGrid ItemsSource="{Binding GridData}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    CanUserReorderColumns="True"
                    CanUserResizeColumns="True"
                    CanUserSortColumns="True"
                    Height="440">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Invoice" Binding="{Binding Invoice}" Width="120" />
              <DataGridTextColumn Header="Client" Binding="{Binding Client}" Width="180" />
              <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
              <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat='{}{0:C}'}" Width="120" />
              <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" />
            </DataGrid.Columns>
          </DataGrid>

          <!-- Markdown columns -->
          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="subtitle" Text="{Binding Strings[DataGrid.Markdown]}" />
              <TextBlock Classes="caption tertiary" Text="{Binding Strings[DataGrid.Markdown.Subtitle]}" />
            </StackPanel>
          </Border>

          <DataGrid ItemsSource="{Binding MarkdownGridData}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    CanUserReorderColumns="True"
                    CanUserResizeColumns="True"
                    CanUserSortColumns="False"
                    RowHeight="NaN"
                    Height="440">
            <DataGrid.Columns>
              <DataGridTemplateColumn Width="180">
                <DataGridTemplateColumn.Header>
                  <sc:StrataMarkdown IsInline="True" Markdown="**Endpoint** `path`" FontSize="12" />
                </DataGridTemplateColumn.Header>
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <sc:StrataMarkdown IsInline="True" Markdown="{Binding Endpoint}"
                                       Margin="12,6" VerticalAlignment="Center" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Width="*">
                <DataGridTemplateColumn.Header>
                  <sc:StrataMarkdown IsInline="True" Markdown="**Description** *summary*" FontSize="12" />
                </DataGridTemplateColumn.Header>
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <sc:StrataMarkdown IsInline="True" Markdown="{Binding Description}"
                                       Margin="12,6" VerticalAlignment="Center" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Width="100">
                <DataGridTemplateColumn.Header>
                  <sc:StrataMarkdown IsInline="True" Markdown="**Status**" FontSize="12" />
                </DataGridTemplateColumn.Header>
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <sc:StrataMarkdown IsInline="True" Markdown="{Binding Status}"
                                       Margin="12,6" VerticalAlignment="Center" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Width="200">
                <DataGridTemplateColumn.Header>
                  <sc:StrataMarkdown IsInline="True" Markdown="**Auth** `scope`" FontSize="12" />
                </DataGridTemplateColumn.Header>
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <sc:StrataMarkdown IsInline="True" Markdown="{Binding Auth}"
                                       Margin="12,6" VerticalAlignment="Center" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
            </DataGrid.Columns>
          </DataGrid>
        </StackPanel>
      </ScrollViewer>

      <!-- ════════ Page 3: Components ════════ -->
      <ScrollViewer x:Name="Page3"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="False">
        <StackPanel Classes="page-shell" Spacing="32" MaxWidth="920">

          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="headline" Text="{Binding Strings[Components]}" />
              <TextBlock Classes="secondary" Text="{Binding Strings[Components.Subtitle]}" />
            </StackPanel>
          </Border>

          <Border Classes="strata-card">
            <StackPanel Spacing="10">
              <TextBlock Classes="subtitle" Text="{Binding Strings[TabControl]}" />
              <TextBlock Classes="caption tertiary" Text="{Binding Strings[TabControl.Subtitle]}" Margin="0,0,0,2" />
              <TabControl>
                <TabItem Header="{Binding Strings[Overview]}">
                  <StackPanel Margin="4,14" Spacing="6">
                    <TextBlock Classes="body-strong" Text="Unified design language" />
                    <TextBlock Classes="secondary" TextWrapping="Wrap"
                               Text="Every control in Strata shares the same spacing, radius, and color tokens — creating a cohesive visual rhythm across dashboards, forms, and data views." />
                  </StackPanel>
                </TabItem>
                <TabItem Header="{Binding Strings[Activity]}">
                  <StackPanel Margin="4,14" Spacing="6">
                    <TextBlock Classes="body-strong" Text="Recent changes" />
                    <TextBlock Classes="secondary" TextWrapping="Wrap"
                               Text="Activity feeds, notifications, and real-time updates can be displayed here with consistent styling and clear visual hierarchy." />
                  </StackPanel>
                </TabItem>
                <TabItem Header="{Binding Strings[Analytics]}">
                  <StackPanel Margin="4,14" Spacing="6">
                    <TextBlock Classes="body-strong" Text="Insights at a glance" />
                    <TextBlock Classes="secondary" TextWrapping="Wrap"
                               Text="Charts, sparklines, and key metrics rendered with the same token-driven styling for a seamless analytical experience." />
                  </StackPanel>
                </TabItem>
              </TabControl>
            </StackPanel>
          </Border>

          <Border Classes="strata-card">
            <StackPanel Spacing="10">
              <TextBlock Classes="subtitle" Text="{Binding Strings[Expander]}" />
              <TextBlock Classes="caption tertiary" Text="{Binding Strings[Expander.Subtitle]}" Margin="0,0,0,2" />
              <Expander Header="{Binding Strings[AdvancedSettings]}">
                <StackPanel Spacing="8" Margin="0,4">
                  <CheckBox Content="{Binding Strings[EnableExperimental]}" />
                  <CheckBox Content="{Binding Strings[VerboseLogging]}" />
                  <TextBox Watermark="{Binding Strings[CustomEndpoint]}" />
                </StackPanel>
              </Expander>
              <Expander Header="{Binding Strings[About]}" IsExpanded="True">
                <TextBlock Classes="secondary"
                           TextWrapping="Wrap"
                           Text="Strata UI is a token-driven Avalonia theme for modern professional desktop applications. It prioritizes readability, consistency, and accessible contrast across light, dark, and high-contrast variants." />
              </Expander>
            </StackPanel>
          </Border>

          <Grid x:Name="ComponentsPairGrid" ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card">
              <StackPanel Spacing="10">
                <TextBlock Classes="subtitle" Text="{Binding Strings[ListBox]}" />
                <TextBlock Classes="caption tertiary" Text="{Binding Strings[ListBox.Subtitle]}" Margin="0,0,0,2" />
                <ListBox Height="200">
                  <ListBoxItem Content="Dashboard" />
                  <ListBoxItem Content="Analytics" />
                  <ListBoxItem Content="Reports" IsSelected="True" />
                  <ListBoxItem Content="Team Members" />
                  <ListBoxItem Content="Billing" />
                </ListBox>
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card">
              <StackPanel Spacing="10">
                <TextBlock Classes="subtitle" Text="{Binding Strings[OverlayPanel]}" />
                <TextBlock Classes="caption tertiary" Text="{Binding Strings[OverlayPanel.Subtitle]}" Margin="0,0,0,2" />
                <Border Classes="strata-dialog" HorizontalAlignment="Stretch">
                  <StackPanel Spacing="12">
                    <TextBlock Classes="subtitle" Text="{Binding Strings[ConfirmAction]}" />
                    <TextBlock Classes="secondary" TextWrapping="Wrap"
                               Text="{Binding Strings[ConfirmAction.Body]}" />
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                      <Button Content="{Binding Strings[Cancel]}" />
                      <Button Classes="accent" Content="{Binding Strings[Confirm]}" />
                    </StackPanel>
                  </StackPanel>
                </Border>
              </StackPanel>
            </Border>
          </Grid>
        </StackPanel>
      </ScrollViewer>

      <!-- ════════ Page 4: UX Controls ════════ -->
      <ScrollViewer x:Name="Page4"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="False">
        <StackPanel Classes="page-shell" Spacing="32" MaxWidth="920">

          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="headline" Text="Custom UX Controls" />
              <TextBlock Classes="secondary" Text="General-purpose interaction controls for product UX." />
            </StackPanel>
          </Border>

          <!-- ── StrataLens ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataLens" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Collapsible reading surface. Header and summary always visible; click to reveal detail." />
              </StackPanel>

              <sc:StrataLens>
                <sc:StrataLens.Header>
                  <TextBlock Classes="body-strong" Text="Q4 Revenue Review" />
                </sc:StrataLens.Header>
                <sc:StrataLens.Summary>
                  <TextBlock Classes="secondary" TextWrapping="Wrap"
                             Text="Revenue grew 12.5% QoQ, driven by enterprise expansion and larger average deal size." />
                </sc:StrataLens.Summary>
                <sc:StrataLens.Detail>
                  <StackPanel Spacing="8">
                    <TextBlock TextWrapping="Wrap"
                               Text="Q4 2025 reached $84,250 MRR, up 12.5% from Q3. Enterprise accounts contributed 68% of new ARR through seat expansion and annual plan upgrades." />
                    <TextBlock TextWrapping="Wrap" Classes="secondary"
                               Text="Three strategic accounts closed in December. Average deal size increased 23% quarter-over-quarter. Churn improved to 1.8% with NPS up 15 points." />
                  </StackPanel>
                </sc:StrataLens.Detail>
              </sc:StrataLens>
            </StackPanel>
          </Border>

          <!-- ── StrataOrb ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataOrb" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Minimal status indicator for generic UX states." />
              </StackPanel>
              <StackPanel Spacing="10">
                <sc:StrataOrb Label="Idle" State="Idle" />
                <sc:StrataOrb Label="Active" State="Active" />
                <sc:StrataOrb Label="Success" State="Success" />
                <sc:StrataOrb Label="Warning" State="Warning" />
                <sc:StrataOrb Label="Error" State="Error" />
                <sc:StrataOrb Label="Interactive — click to cycle" State="Idle" IsInteractive="True" />
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- ── StrataMarkdown ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataMarkdown" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Strata-native markdown surface for rich text + fenced code. Optimized for chat answers, runbooks, and technical guidance." />
              </StackPanel>

              <sc:StrataMarkdown ShowTitle="True"
                                 Title="Incident Remediation Playbook"
                                 Markdown="### Objective&#x0a;Stabilize latency during rollout while preserving customer experience.&#x0a;&#x0a;### Guardrail Logic&#x0a;```csharp&#x0a;public static bool ShouldRollback(double p95Ms, double gcPauseMs)&#x0a;{&#x0a;    var p95Breached = p95Ms &gt; 250;&#x0a;    var gcBreached = gcPauseMs &gt; 80;&#x0a;    return p95Breached || gcBreached;&#x0a;}&#x0a;```&#x0a;&#x0a;1. Roll out at **10%** traffic&#x0a;2. Validate p95 + GC for 30 minutes&#x0a;3. Expand to **50%** and then **100%** when healthy&#x0a;&#x0a;### Service Health&#x0a;&#x0a;| **Metric** `id` | **Target** | **Current** | *Status* |&#x0a;|--------|--------|---------|--------|&#x0a;| **p95 Latency** | &lt; `250ms` | 180ms | *Healthy* |&#x0a;| **GC Pause** | &lt; `80ms` | 45ms | *Healthy* |&#x0a;| **Error Rate** | &lt; `0.1%` | 0.08% | *Healthy* |&#x0a;| **Throughput** | &gt; `10k rps` | [12.4k rps](https://docs.avaloniaui.net) | ***Critical*** |&#x0a;&#x0a;### Inline Elements&#x0a;Links sit on the baseline: before [Avalonia docs](https://docs.avaloniaui.net) and after.&#x0a;Mixed with `inline code` and **bold** in the same line: see [GitHub](https://github.com) for details." />

              <TextBlock Classes="caption tertiary"
                         Text="Supports headings, lists, inline code, tables (with rich markdown in headers and cells), and fenced language blocks (e.g., csharp)." />
            </StackPanel>
          </Border>

          <!-- ── Mermaid Diagrams via StrataMarkdown ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="{Binding Strings[MermaidDiagrams]}" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="{Binding Strings[MermaidDiagrams.Subtitle]}" />
              </StackPanel>

              <sc:StrataMarkdown IsInline="True"
                                 Markdown="### Flowchart&#x0a;&#x0a;```mermaid&#x0a;graph TD&#x0a;    A[Request Received] --&gt; B{Authenticated?}&#x0a;    B --&gt;|Yes| C[Authorize]&#x0a;    B --&gt;|No| D[Reject 401]&#x0a;    C --&gt; E{Has Permission?}&#x0a;    E --&gt;|Yes| F[Process Request]&#x0a;    E --&gt;|No| G[Reject 403]&#x0a;    F --&gt; H[Return Response]&#x0a;    D --&gt; H&#x0a;    G --&gt; H&#x0a;```" />

              <sc:StrataMarkdown IsInline="True"
                                 Markdown="### Sequence Diagram&#x0a;&#x0a;```mermaid&#x0a;sequenceDiagram&#x0a;    participant Client&#x0a;    participant Gateway as API Gateway&#x0a;    participant Auth&#x0a;    participant Service&#x0a;    participant DB&#x0a;    Client-&gt;&gt;Gateway: POST /api/orders&#x0a;    Gateway-&gt;&gt;Auth: Validate token&#x0a;    Auth--&gt;&gt;Gateway: Token valid&#x0a;    Gateway-&gt;&gt;Service: Forward request&#x0a;    Service-&gt;&gt;DB: INSERT order&#x0a;    DB--&gt;&gt;Service: order_id&#x0a;    Service--&gt;&gt;Gateway: 201 Created&#x0a;    Gateway--&gt;&gt;Client: 201 Created&#x0a;```" />

              <sc:StrataMarkdown IsInline="True"
                                 Markdown="### State Machine&#x0a;&#x0a;```mermaid&#x0a;stateDiagram-v2&#x0a;    [*] --&gt; Idle&#x0a;    Idle --&gt; Validating : submit&#x0a;    Validating --&gt; Processing : valid&#x0a;    Validating --&gt; Failed : invalid&#x0a;    Processing --&gt; Complete : done&#x0a;    Processing --&gt; Failed : error&#x0a;    Failed --&gt; Idle : retry&#x0a;    Complete --&gt; [*]&#x0a;```" />

              <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                         Text="{Binding Strings[MermaidDiagrams.Footer]}" />
            </StackPanel>
          </Border>

          <!-- ── StrataFileAttachment ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataFileAttachment" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Compact file chips with auto-detected icon, status dot, and remove button. Click to open; shows upload pulse animation when uploading." />
              </StackPanel>

              <StackPanel Spacing="8">
                <sc:StrataFileAttachment FileName="quarterly-report.pdf" FileSize="2.4 MB" Status="Completed" />
                <sc:StrataFileAttachment FileName="budget-forecast.xlsx" FileSize="890 KB" Status="Completed" />
                <sc:StrataFileAttachment FileName="architecture-diagram.png" FileSize="1.1 MB" Status="Uploading" Progress="64" />
                <sc:StrataFileAttachment FileName="meeting-notes.md" FileSize="12 KB" Status="Pending" />
                <sc:StrataFileAttachment FileName="deploy-script.cs" FileSize="3.2 KB" Status="Failed" />
                <sc:StrataFileAttachment FileName="logs-archive.zip" FileSize="48 MB" Status="Completed" IsRemovable="False" />
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- ── StrataAttachmentList ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataAttachmentList" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Wrapping container for multiple attachments with an add button. Used in message composers and form surfaces." />
              </StackPanel>

              <sc:StrataAttachmentList ShowAddButton="True" AddButtonText="Attach file">
                <sc:StrataFileAttachment FileName="incident-summary.pdf" FileSize="1.8 MB" Status="Completed" />
                <sc:StrataFileAttachment FileName="metrics-export.csv" FileSize="240 KB" Status="Completed" />
                <sc:StrataFileAttachment FileName="rollout-plan.docx" FileSize="56 KB" Status="Uploading" Progress="30" />
                <sc:StrataFileAttachment FileName="screenshot.png" FileSize="480 KB" Status="Completed" />
              </sc:StrataAttachmentList>
            </StackPanel>
          </Border>

        </StackPanel>
      </ScrollViewer>

      <!-- ════════ Page 5: AI Controls ════════ -->
      <ScrollViewer x:Name="Page5"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="False">
        <StackPanel Classes="page-shell" Spacing="32" MaxWidth="920">

          <Border BorderBrush="{DynamicResource Brush.AccentDefault}" BorderThickness="3,0,0,0" Padding="16,0,0,0">
            <StackPanel Spacing="4">
              <TextBlock Classes="headline" Text="AI Controls" />
              <TextBlock Classes="secondary" Text="Specialized controls for generation, reasoning, provenance, and AI workflows." />
            </StackPanel>
          </Border>

          <!-- ── StrataChatMessage ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataChatMessage" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Text-first messages with inline edit. Hover to see Copy | Edit | Retry toolbar. Click Edit to enter edit mode with Save/Cancel." />
              </StackPanel>

              <StackPanel Spacing="6">
                <!-- User (editable) -->
                <sc:StrataChatMessage Role="User" IsEditable="True" Author="You" Timestamp="09:42" StatusText="sent">
                  <sc:StrataChatMessage.Content>
                    <TextBlock TextWrapping="Wrap" FontSize="13"
                               Text="Review incident IR-4471 and recommend a mitigation plan." />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <!-- Assistant -->
                <sc:StrataChatMessage Role="Assistant" IsEditable="True" Author="Strata" Timestamp="09:42" StatusText="grounded">
                  <sc:StrataChatMessage.Content>
                    <TextBlock TextWrapping="Wrap" FontSize="13"
                               Foreground="{DynamicResource Brush.TextPrimary}"
                               Text="Allocation bursts in the serializer hot path caused GC pause inflation, degrading p95 latency by 340 ms during peak traffic windows." />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <sc:StrataChatMessage Role="Assistant" IsEditable="True" IsEditing="True" Author="Strata" Timestamp="09:43" StatusText="editing">
                  <sc:StrataChatMessage.Content>
                    <TextBlock TextWrapping="Wrap" FontSize="13"
                               Foreground="{DynamicResource Brush.TextPrimary}"
                               Text="I'm now comparing against pre-change baselines to isolate regressions introduced by this patch." />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <!-- Assistant Markdown + C# code -->
                <sc:StrataChatMessage Role="Assistant" IsEditable="True" Author="Strata" Timestamp="09:43" StatusText="markdown">
                  <sc:StrataChatMessage.Content>
                    <sc:StrataMarkdown IsInline="True" Markdown="# Suggested fix&#x0a;Use a staged rollout and cap payload size for hot serializer paths.&#x0a;&#x0a;```csharp&#x0a;public static bool ShouldRollback(double p95Ms, double gcPauseMs)&#x0a;{&#x0a;    if (p95Ms &gt; 250 || gcPauseMs &gt; 80)&#x0a;        return true;&#x0a;&#x0a;    return false;&#x0a;}&#x0a;```&#x0a;&#x0a;- Gate rollout at 10%, 50%, 100%&#x0a;- Roll back immediately on threshold breach" />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <!-- Assistant Markdown with inline code -->
                <sc:StrataChatMessage Role="Assistant" IsEditable="True" Author="Strata" Timestamp="09:43" StatusText="inline code">
                  <sc:StrataChatMessage.Content>
                    <sc:StrataMarkdown IsInline="True" Markdown="The config lives in `appsettings.json` under the `Serializer` section. See the file `HotPathSerializer.cs` for the allocation site, and make sure `MaxBatchBytes` is set before deploying." />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <!-- Tool (not editable) -->
                <sc:StrataChatMessage Role="Tool" IsEditable="False" Author="tool.search()" Timestamp="09:44" StatusText="3 hits">
                  <sc:StrataChatMessage.Content>
                    <StackPanel Spacing="4">
                      <StackPanel Orientation="Horizontal" Spacing="8">
                        <Border Background="{DynamicResource Brush.DangerSubtle}" CornerRadius="4" Padding="6,2">
                          <TextBlock Text="P2" FontSize="11" FontWeight="Bold"
                                     Foreground="{DynamicResource Brush.DangerDefault}" />
                        </Border>
                        <TextBlock Text="Scale worker pool and cap batch payload" FontSize="12"
                                   FontWeight="SemiBold" VerticalAlignment="Center" />
                      </StackPanel>
                      <TextBlock TextWrapping="Wrap" FontSize="12"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="Setting batch_max_bytes = 262144 reduces serializer pressure." />
                    </StackPanel>
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <!-- Streaming (not editable while streaming) -->
                <sc:StrataChatMessage Role="Assistant" IsStreaming="True" IsEditable="False" Author="Strata" Timestamp="09:45" StatusText="streaming">
                  <sc:StrataChatMessage.Content>
                    <TextBlock TextWrapping="Wrap" FontSize="13"
                               Foreground="{DynamicResource Brush.TextPrimary}"
                               Text="Additionally, I'd recommend setting up an automated alert on the GC pause duration metric…" />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>

                <!-- System -->
                <sc:StrataChatMessage Role="System" Author="System" Timestamp="policy">
                  <sc:StrataChatMessage.Content>
                    <TextBlock FontSize="12" FontStyle="Italic"
                               Foreground="{DynamicResource Brush.TextTertiary}"
                               Text="Workspace policies loaded. Grounded citations enabled." />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- ── StrataTypingIndicator ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataTypingIndicator" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Inline status: pulsing accent dot with label text. Active state animates, inactive dims." />
              </StackPanel>

              <StackPanel Spacing="12">
                <sc:StrataTypingIndicator IsActive="True"
                                         Label="Validating behavior with targeted tests next so findings are evidence-based" />
                <sc:StrataTypingIndicator IsActive="True"
                                         Label="Generating response…" />
                <sc:StrataTypingIndicator IsActive="False"
                                         Label="Paused" />
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- ── StrataChatComposer ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataChatComposer" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Bottom-bar input with borderless text area, + attach, model/quality chips, and circular accent send button." />
              </StackPanel>

              <sc:StrataChatComposer Placeholder="Ask for follow-up changes"
                                    Models="{Binding AiModels}"
                                    SelectedModel="GPT-4o"
                                    QualityLevels="{Binding AiQualityLevels}"
                                    SelectedQuality="High" />

              <sc:StrataChatComposer x:Name="DemoComposer"
                                    Placeholder="What would you like to know?"
                                    Models="{Binding AiModels}"
                                    SelectedModel="GPT-5.3-Codex"
                                    QualityLevels="{Binding AiQualityLevels}"
                                    SelectedQuality="Extra High"
                                    AgentName="Code Reviewer"
                                    AgentGlyph="◉"
                                    SkillItems="{Binding AiSkills}"
                                    AvailableAgents="{Binding AvailableAgents}"
                                    AvailableSkills="{Binding AvailableSkills}"
                                    SuggestionA="Summarize"
                                    SuggestionB="Root cause"
                                    SuggestionC="Action items" />
            </StackPanel>
          </Border>

          <!-- ── StrataChatShell ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataChatShell" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Minimal container: scrollable transcript with docked composer. No heavy header chrome." />
              </StackPanel>

              <sc:StrataChatShell IsOnline="True" MinHeight="340">
                <sc:StrataChatShell.Header>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Classes="body-strong" Text="Incident Assistant" />
                    <TextBlock Classes="caption tertiary" Text="workspace / prod" VerticalAlignment="Center" />
                  </StackPanel>
                </sc:StrataChatShell.Header>
                <sc:StrataChatShell.PresenceText>Connected</sc:StrataChatShell.PresenceText>
                <sc:StrataChatShell.Transcript>
                  <StackPanel Spacing="4">
                    <sc:StrataChatMessage Role="User" Author="You" Timestamp="09:49" StatusText="sent">
                      <sc:StrataChatMessage.Content>
                        <TextBlock TextWrapping="Wrap" FontSize="13"
                                   Text="What caused the latency spike?" />
                      </sc:StrataChatMessage.Content>
                    </sc:StrataChatMessage>
                    <sc:StrataChatMessage Role="Assistant" Author="Strata" Timestamp="09:49" StatusText="grounded">
                      <sc:StrataChatMessage.Content>
                        <TextBlock TextWrapping="Wrap" FontSize="13"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   Text="GC pause inflation from allocation bursts in the serializer hot path during peak traffic." />
                      </sc:StrataChatMessage.Content>
                    </sc:StrataChatMessage>
                    <sc:StrataTypingIndicator IsActive="True" Label="Checking deployment logs…" />
                  </StackPanel>
                </sc:StrataChatShell.Transcript>
                <sc:StrataChatShell.Composer>
                  <sc:StrataChatComposer Placeholder="Follow up…"
                                        Models="{Binding AiModels}"
                                        SelectedModel="GPT-4o"
                                        QualityLevels="{Binding AiQualityLevels}"
                                        SelectedQuality="High" />
                </sc:StrataChatShell.Composer>
              </sc:StrataChatShell>
            </StackPanel>
          </Border>

          <!-- ── StrataCanvas ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="16">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataCanvas" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Artifact canvas surfaces generated content alongside conversation. Live stream rail, version navigation, status pulse, layered inner surface, and chat-aware layout." />
              </StackPanel>

              <!-- Row 1: Code canvas (generating) + Document canvas (ready) -->
              <Grid ColumnDefinitions="*,14,*">

                <!-- Code canvas: live generation with stream rail -->
                <sc:StrataCanvas Grid.Column="0"
                                 Title="incident_analyzer.py"
                                 Subtitle="Python · Generating"
                                 IsGenerating="True"
                                 Version="2" VersionCount="3"
                                 ShowCloseButton="True"
                                 MinHeight="280">
                  <sc:StrataCanvas.Icon>
                    <Border Width="20" Height="20" CornerRadius="5"
                            Background="{DynamicResource Brush.AccentSubtle}">
                      <TextBlock Text="Py" FontSize="8" FontWeight="Bold"
                                 Foreground="{DynamicResource Brush.AccentDefault}"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                  </sc:StrataCanvas.Icon>
                  <sc:StrataCanvas.ToolBar>
                    <StackPanel Orientation="Horizontal" Spacing="1">
                      <Button Classes="subtle" Padding="6,3" MinHeight="0" CornerRadius="4">
                        <TextBlock Text="Copy" FontSize="11"
                                   Foreground="{DynamicResource Brush.TextTertiary}" />
                      </Button>
                      <Button Classes="subtle" Padding="6,3" MinHeight="0" CornerRadius="4">
                        <TextBlock Text="Insert" FontSize="11"
                                   Foreground="{DynamicResource Brush.AccentDefault}" />
                      </Button>
                    </StackPanel>
                  </sc:StrataCanvas.ToolBar>
                  <sc:StrataCanvas.Content>
                    <SelectableTextBlock FontFamily="Cascadia Code, Consolas, monospace"
                                         FontSize="12"
                                         Foreground="{DynamicResource Brush.TextPrimary}"
                                         xml:space="preserve"
                                         TextWrapping="Wrap">import asyncio
from dataclasses import dataclass

@dataclass
class IncidentReport:
    id: str
    severity: str
    summary: str
    root_cause: str | None = None

async def analyze_incident(report):
    """Correlate signals and suggest mitigations."""
    events = await fetch_correlated_events(
        report.id,
        window="24h"
    )
    hypothesis = rank_hypotheses(events)
    return {
        "root_cause": hypothesis[0].label,
        "confidence": hypothesis[0].score,
        "mitigations": suggest(hypothesis),
        "evidence": [e.ref for e in events[:5]]
    }</SelectableTextBlock>
                  </sc:StrataCanvas.Content>
                  <sc:StrataCanvas.Footer>
                    <DockPanel>
                      <TextBlock DockPanel.Dock="Right"
                                 FontSize="11"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="v2 · 3s ago" />
                      <StackPanel Orientation="Horizontal" Spacing="6">
                        <Border Width="5" Height="5" CornerRadius="2.5"
                                Background="{DynamicResource Brush.AccentDefault}"
                                VerticalAlignment="Center" />
                        <TextBlock FontSize="11"
                                   Foreground="{DynamicResource Brush.TextTertiary}"
                                   Text="Generating…" />
                      </StackPanel>
                    </DockPanel>
                  </sc:StrataCanvas.Footer>
                </sc:StrataCanvas>

                <!-- Document canvas: ready state with structured content -->
                <sc:StrataCanvas Grid.Column="2"
                                 Title="Incident Summary"
                                 Subtitle="IR-4471 · Auto-generated"
                                 IsGenerating="False"
                                 ShowCloseButton="False"
                                 MinHeight="280">
                  <sc:StrataCanvas.Icon>
                    <Border Width="20" Height="20" CornerRadius="5"
                            Background="{DynamicResource Brush.AccentGradient}">
                      <TextBlock Text="S" FontSize="9" FontWeight="Bold"
                                 Foreground="{DynamicResource Brush.TextOnAccent}"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                  </sc:StrataCanvas.Icon>
                  <sc:StrataCanvas.ToolBar>
                    <StackPanel Orientation="Horizontal" Spacing="1">
                      <Button Classes="subtle" Padding="6,3" MinHeight="0" CornerRadius="4">
                        <TextBlock Text="Export" FontSize="11"
                                   Foreground="{DynamicResource Brush.TextTertiary}" />
                      </Button>
                    </StackPanel>
                  </sc:StrataCanvas.ToolBar>
                  <sc:StrataCanvas.Content>
                    <StackPanel Spacing="12">
                      <StackPanel Spacing="3">
                        <TextBlock FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   Text="Root Cause" />
                        <TextBlock FontSize="12" TextWrapping="Wrap"
                                   Foreground="{DynamicResource Brush.TextSecondary}"
                                   Text="GC pause inflation from allocation bursts in the serializer hot path during peak traffic on worker pool C." />
                      </StackPanel>
                      <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Opacity="0.4" />
                      <StackPanel Spacing="3">
                        <TextBlock FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   Text="Mitigation" />
                        <StackPanel Spacing="2">
                          <TextBlock FontSize="12" TextWrapping="Wrap"
                                     Foreground="{DynamicResource Brush.TextSecondary}"
                                     Text="1. Enable autoscale policy w/ p95 &lt; 250ms gate" />
                          <TextBlock FontSize="12" TextWrapping="Wrap"
                                     Foreground="{DynamicResource Brush.TextSecondary}"
                                     Text="2. Tune GC thresholds to reduce alloc pressure" />
                          <TextBlock FontSize="12" TextWrapping="Wrap"
                                     Foreground="{DynamicResource Brush.TextSecondary}"
                                     Text="3. Stage rollout 25% → 50% → 100% w/ rollback" />
                        </StackPanel>
                      </StackPanel>
                      <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Opacity="0.4" />
                      <StackPanel Spacing="3">
                        <TextBlock FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   Text="Impact" />
                        <TextBlock FontSize="12" TextWrapping="Wrap"
                                   Foreground="{DynamicResource Brush.TextSecondary}"
                                   Text="~12% of requests affected at peak. No data loss. Normalized within 8 min of fix deployment." />
                      </StackPanel>
                    </StackPanel>
                  </sc:StrataCanvas.Content>
                  <sc:StrataCanvas.Footer>
                    <DockPanel>
                      <TextBlock DockPanel.Dock="Right"
                                 FontSize="11"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="Confidence 88%" />
                      <StackPanel Orientation="Horizontal" Spacing="6">
                        <Border Width="5" Height="5" CornerRadius="2.5"
                                Background="{DynamicResource Brush.SuccessDefault}"
                                VerticalAlignment="Center" />
                        <TextBlock FontSize="11"
                                   Foreground="{DynamicResource Brush.TextTertiary}"
                                   Text="Ready" />
                      </StackPanel>
                    </DockPanel>
                  </sc:StrataCanvas.Footer>
                </sc:StrataCanvas>

              </Grid>

              <!-- Row 2: Chat + Canvas side-by-side (production layout) -->
              <TextBlock Classes="caption tertiary" Text="Chat × Canvas integration" Margin="0,4,0,0" />
              <Grid ColumnDefinitions="1.1*,10,*" MinHeight="340">

                <!-- Conversation surface -->
                <sc:StrataChatShell Grid.Column="0"
                                    IsOnline="True"
                                    MinHeight="320">
                  <sc:StrataChatShell.Header>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                      <Border Width="20" Height="20" CornerRadius="6"
                              Background="{DynamicResource Brush.AccentGradient}">
                        <TextBlock Text="S" FontSize="10" FontWeight="Bold"
                                   Foreground="{DynamicResource Brush.TextOnAccent}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Classes="body-strong" Text="Assistant" />
                    </StackPanel>
                  </sc:StrataChatShell.Header>
                  <sc:StrataChatShell.PresenceText>Connected</sc:StrataChatShell.PresenceText>
                  <sc:StrataChatShell.Transcript>
                    <StackPanel Spacing="4">
                      <sc:StrataChatMessage Role="User">
                        <sc:StrataChatMessage.Content>
                          <TextBlock TextWrapping="Wrap" FontSize="13"
                                     Text="Create a rollout checklist for IR-4471 with rollback gates" />
                        </sc:StrataChatMessage.Content>
                      </sc:StrataChatMessage>

                      <sc:StrataChatMessage Role="Assistant" StatusText="canvas opened">
                        <sc:StrataChatMessage.Content>
                          <StackPanel Spacing="6">
                            <TextBlock TextWrapping="Wrap" FontSize="13"
                                       Foreground="{DynamicResource Brush.TextPrimary}"
                                       Text="I've created a staged rollout checklist with rollback gates at each stage. Review and check off items as you proceed." />
                            <!-- Inline canvas reference chip -->
                            <Border Background="{DynamicResource Brush.AccentSubtle}"
                                    BorderBrush="{DynamicResource Brush.AccentDefault}"
                                    BorderThickness="1"
                                    CornerRadius="6"
                                    Padding="8,4"
                                    HorizontalAlignment="Left">
                              <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Width="5" Height="5" CornerRadius="2.5"
                                        Background="{DynamicResource Brush.AccentDefault}"
                                        VerticalAlignment="Center" />
                                <TextBlock FontSize="11" FontWeight="SemiBold"
                                           Foreground="{DynamicResource Brush.AccentDefault}"
                                           Text="Rollout Checklist" />
                                <TextBlock FontSize="11"
                                           Foreground="{DynamicResource Brush.TextTertiary}"
                                           Text="· 6 items" />
                              </StackPanel>
                            </Border>
                          </StackPanel>
                        </sc:StrataChatMessage.Content>
                      </sc:StrataChatMessage>

                      <sc:StrataChatMessage Role="User">
                        <sc:StrataChatMessage.Content>
                          <TextBlock TextWrapping="Wrap" FontSize="13"
                                     Text="Add a comms step after the 50% gate" />
                        </sc:StrataChatMessage.Content>
                      </sc:StrataChatMessage>

                      <sc:StrataTypingIndicator IsActive="True" Label="Updating canvas…" />
                    </StackPanel>
                  </sc:StrataChatShell.Transcript>
                  <sc:StrataChatShell.Composer>
                    <sc:StrataChatComposer Placeholder="Refine the canvas…" />
                  </sc:StrataChatShell.Composer>
                </sc:StrataChatShell>

                <!-- Canvas artifact: interactive checklist -->
                <sc:StrataCanvas Grid.Column="2"
                                 Title="Rollout Checklist"
                                 Subtitle="IR-4471 · Staged"
                                 IsGenerating="True"
                                 Version="2" VersionCount="2"
                                 ShowCloseButton="True"
                                 MinHeight="320">
                  <sc:StrataCanvas.Icon>
                    <Border Width="20" Height="20" CornerRadius="5"
                            Background="{DynamicResource Brush.AccentSubtle}">
                      <TextBlock Text="☑" FontSize="10"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                  </sc:StrataCanvas.Icon>
                  <sc:StrataCanvas.ToolBar>
                    <StackPanel Orientation="Horizontal" Spacing="1">
                      <Button Classes="subtle" Padding="6,3" MinHeight="0" CornerRadius="4">
                        <TextBlock Text="Copy" FontSize="11"
                                   Foreground="{DynamicResource Brush.TextTertiary}" />
                      </Button>
                      <Button Classes="subtle" Padding="6,3" MinHeight="0" CornerRadius="4">
                        <TextBlock Text="Export" FontSize="11"
                                   Foreground="{DynamicResource Brush.TextTertiary}" />
                      </Button>
                    </StackPanel>
                  </sc:StrataCanvas.ToolBar>
                  <sc:StrataCanvas.Content>
                    <StackPanel Spacing="4">
                      <!-- Stage 1 -->
                      <TextBlock FontSize="11" FontWeight="SemiBold"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="STAGE 1 · CANARY" Margin="0,0,0,2" />
                      <CheckBox IsChecked="True" Content="Confirm autoscale policy thresholds" FontSize="12" />
                      <CheckBox IsChecked="True" Content="Validate GC tuning parameters" FontSize="12" />
                      <CheckBox IsChecked="True" Content="Deploy to canary pool (5%)" FontSize="12" />
                      <CheckBox IsChecked="True" Content="Monitor p95 for 10 min" FontSize="12" />
                      <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Opacity="0.3" Margin="0,4" />
                      <!-- Stage 2 -->
                      <TextBlock FontSize="11" FontWeight="SemiBold"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="STAGE 2 · EXPANSION" Margin="0,0,0,2" />
                      <CheckBox Content="Expand to 25% with rollback gate" FontSize="12" />
                      <CheckBox Content="Monitor p95 &lt; 250ms for 15 min" FontSize="12" />
                      <CheckBox Content="Expand to 50% with rollback gate" FontSize="12" />
                      <CheckBox Content="Send stakeholder status update" FontSize="12"
                                Foreground="{DynamicResource Brush.AccentDefault}" />
                      <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" Opacity="0.3" Margin="0,4" />
                      <!-- Stage 3 -->
                      <TextBlock FontSize="11" FontWeight="SemiBold"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="STAGE 3 · FULL ROLLOUT" Margin="0,0,0,2" />
                      <CheckBox Content="Full rollout with sign-off" FontSize="12" />
                      <CheckBox Content="Close incident IR-4471" FontSize="12" />
                    </StackPanel>
                  </sc:StrataCanvas.Content>
                  <sc:StrataCanvas.Footer>
                    <DockPanel>
                      <TextBlock DockPanel.Dock="Right"
                                 FontSize="11"
                                 Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="4 of 11 complete" />
                      <StackPanel Orientation="Horizontal" Spacing="8">
                        <ProgressBar Value="36" Minimum="0" Maximum="100"
                                     Height="4" CornerRadius="2"
                                     Width="60"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center" />
                        <TextBlock FontSize="11"
                                   Foreground="{DynamicResource Brush.AccentDefault}"
                                   Text="Updating…"
                                   VerticalAlignment="Center" />
                      </StackPanel>
                    </DockPanel>
                  </sc:StrataCanvas.Footer>
                </sc:StrataCanvas>

              </Grid>
            </StackPanel>
          </Border>

          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="18">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="AI Concepts: Tool • Skill • Agent" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Composable building blocks aligned with modern agent workflows: tool calls, reusable skills, and custom agents." />
              </StackPanel>

              <!-- Tool Calls -->
              <StackPanel Spacing="10">
                <TextBlock Classes="caption tertiary" Text="Tool Calls" />
                <Grid ColumnDefinitions="*,10,*">
                  <StackPanel Grid.Column="0" Spacing="8">
                    <sc:StrataAiToolCall ToolName="search_incident_logs"
                                        Status="Completed"
                                        DurationMs="412"
                                        InputParameters="{}{ incident: IR-4471, range: last_24h }"
                                        MoreInfo="Found 3 correlated spikes near serializer allocation bursts." />
                    <sc:StrataAiToolCall ToolName="validate_policy_guardrails"
                                        Status="InProgress"
                                        DurationMs="236"
                                        InputParameters="{}{ policy: rollout.guardrail.v2 }"
                                        MoreInfo="Checking compliance constraints before continue." />
                  </StackPanel>
                  <StackPanel Grid.Column="2" Spacing="8">
                    <sc:StrataAiToolCall ToolName="execute_rollout_stage"
                                        Status="Failed"
                                        DurationMs="1883"
                                        InputParameters="{}{ stage: 50_percent, gate: p95_lt_250 }"
                                        MoreInfo="Gate failed: p95=312ms; rollback signal emitted." />
                    <sc:StrataAiToolCall ToolName="publish_status_update"
                                        Status="InProgress"
                                        DurationMs="141"
                                        InputParameters="{}{ channel: incident-room }"
                                        MoreInfo="Posting interim status to responders and stakeholders." />
                  </StackPanel>
                </Grid>
              </StackPanel>

              <!-- Skills -->
              <StackPanel Spacing="10">
                <TextBlock Classes="caption tertiary" Text="Skills" />
                <sc:StrataAiSkill SkillName="Incident Summarization"
                                  IconGlyph="Σ"
                                  Description="Turns incident traces into concise summaries with action-ready recommendations."
                                  DetailMarkdown="## Incident Summarization&#10;Creates an executive-ready incident brief from logs, traces and runbooks.&#10;&#10;### Produces&#10;- Situation summary&#10;- Root-cause hypotheses&#10;- Recommended next actions&#10;&#10;### Guardrails&#10;- Avoid speculative claims&#10;- Always include confidence qualifiers" />

                <sc:StrataAiSkill SkillName="Change Request Executor"
                                  IconGlyph="⚙"
                                  Description="Executes approved runbook actions through policy-gated workflows."
                                  DetailMarkdown="## Change Request Executor&#10;Runs approved actions only after policy and approval checks pass.&#10;&#10;### Inputs&#10;`change_id`, `approval_token`&#10;&#10;### Outputs&#10;`execution_id`, `status`, `audit_ref`" />
              </StackPanel>

              <!-- Agents -->
              <StackPanel Spacing="10">
                <TextBlock Classes="caption tertiary" Text="Agents" />
                <sc:StrataAiAgent AgentName="Remediation Planner"
                                  IconGlyph="R"
                                  Description="Coordinates tool calls and skills to draft mitigation plans with rollback gates."
                                  ToolsCount="6"
                                  SkillsCount="5"
                                  DetailMarkdown="## Remediation Planner&#10;Synthesizes incidents into mitigation plans with staged rollout + rollback checkpoints.&#10;&#10;### Output&#10;- Mitigation plan&#10;- Rollback gates&#10;- Stakeholder comms summary">
                  <sc:StrataAiAgent.SkillsContent>
                    <StackPanel Spacing="8">
                      <sc:StrataAiSkill SkillName="Incident Summarization"
                                        IconGlyph="Σ"
                                        Description="Turns incident traces into concise summaries with action-ready recommendations."
                                        DetailMarkdown="## Incident Summarization&#10;Summarizes incidents with confidence qualifiers and next actions." />
                    </StackPanel>
                  </sc:StrataAiAgent.SkillsContent>
                  <sc:StrataAiAgent.ToolsContent>
                    <Grid ColumnDefinitions="*,10,*">
                      <StackPanel Grid.Column="0" Spacing="8">
                        <sc:StrataAiToolCall ToolName="monitor.query"
                                            Status="Completed"
                                            DurationMs="93"
                                            InputParameters="{}{ query: p95, window: 30m }"
                                            MoreInfo="Fetched telemetry for service cluster C." />
                        <sc:StrataAiToolCall ToolName="runbook.fetch"
                                            Status="Completed"
                                            DurationMs="81"
                                            InputParameters="{}{ id: autoscale.md }"
                                            MoreInfo="Loaded remediation runbook and rollback procedure." />
                      </StackPanel>
                      <StackPanel Grid.Column="2" Spacing="8">
                        <sc:StrataAiToolCall ToolName="rollout.execute"
                                            Status="InProgress"
                                            DurationMs="148"
                                            InputParameters="{}{ stage: 25_percent }"
                                            MoreInfo="Executing canary stage with rollback gate checks." />
                        <sc:StrataAiToolCall ToolName="risk.score"
                                            Status="InProgress"
                                            DurationMs="122"
                                            InputParameters="{}{ candidate_plan: plan_19 }"
                                            MoreInfo="Scoring blast-radius and dependency impacts." />
                      </StackPanel>
                    </Grid>
                  </sc:StrataAiAgent.ToolsContent>
                </sc:StrataAiAgent>

                <sc:StrataAiAgent AgentName="Postmortem Drafter"
                                  IconGlyph="P"
                                  Description="Converts traces and timeline artifacts into structured incident reports."
                                  ToolsCount="2"
                                  SkillsCount="3"
                                  DetailMarkdown="## Postmortem Drafter&#10;Transforms evidence into a clear postmortem format for engineering and leadership.&#10;&#10;### Sections&#10;- Timeline&#10;- Detection &amp; response&#10;- Root cause and contributing factors&#10;- Follow-up actions">
                  <sc:StrataAiAgent.SkillsContent>
                    <StackPanel Spacing="8">
                      <sc:StrataAiSkill SkillName="Narrative Composer"
                                        IconGlyph="N"
                                        Description="Builds a coherent timeline and technical narrative from raw evidence."
                                        DetailMarkdown="## Narrative Composer&#10;Converts incident events into a readable postmortem storyline." />
                    </StackPanel>
                  </sc:StrataAiAgent.SkillsContent>
                  <sc:StrataAiAgent.ToolsContent>
                    <StackPanel Spacing="8">
                      <sc:StrataAiToolCall ToolName="timeline.fetch"
                                          Status="Completed"
                                          DurationMs="71"
                                          InputParameters="{}{ incident: IR-4471 }"
                                          MoreInfo="Loaded event timeline with 63 entries." />
                    </StackPanel>
                  </sc:StrataAiAgent.ToolsContent>
                </sc:StrataAiAgent>
              </StackPanel>

              <!-- Embedded in chat -->
              <StackPanel Spacing="6">
                <TextBlock Classes="caption tertiary" Text="Embedded in chat" />
                <sc:StrataChatMessage Role="Tool" Author="tool.call" Timestamp="10:08" StatusText="embedded concept">
                  <sc:StrataChatMessage.Content>
                    <sc:StrataAiToolCall ToolName="fetch_runbook"
                                        Status="InProgress"
                                        DurationMs="128"
                                        InputParameters="{}{ id: autoscale.md }"
                                        MoreInfo="Retrieving autoscale policy and rollback section..." />
                  </sc:StrataChatMessage.Content>
                </sc:StrataChatMessage>
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- ── StrataFork + StrataConfidence ── -->
          <Grid x:Name="AiForkGrid" ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card" Padding="24,20">
              <StackPanel Spacing="14">
                <StackPanel Spacing="3">
                  <TextBlock Classes="subtitle" Text="StrataFork" />
                  <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                             Text="Switch between generated branches." />
                </StackPanel>
                <sc:StrataFork OptionATitle="Concise" OptionBTitle="Detailed" SelectedIndex="0">
                  <sc:StrataFork.OptionAContent>
                    <StackPanel Spacing="6">
                      <TextBlock Classes="body-strong" Text="Executive Summary" />
                      <TextBlock Classes="secondary" TextWrapping="Wrap"
                                 Text="Adopt event-driven architecture in Q2. Improves resilience and supports independent scaling." />
                    </StackPanel>
                  </sc:StrataFork.OptionAContent>
                  <sc:StrataFork.OptionBContent>
                    <StackPanel Spacing="6">
                      <TextBlock Classes="body-strong" Text="Technical Rationale" />
                      <TextBlock TextWrapping="Wrap"
                                 Text="Synchronous REST chains show 340ms p99 under peak load. Event-driven flow decouples lifecycles." />
                    </StackPanel>
                  </sc:StrataFork.OptionBContent>
                </sc:StrataFork>
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card" Padding="24,20">
              <StackPanel Spacing="14">
                <StackPanel Spacing="3">
                  <TextBlock Classes="subtitle" Text="StrataConfidence" />
                  <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                             Text="Confidence gauge. First bar is editable." />
                </StackPanel>
                <StackPanel Spacing="12">
                  <sc:StrataConfidence Label="Policy Match" Confidence="91" IsEditable="True">
                    <sc:StrataConfidence.Explanation>
                      <TextBlock Classes="caption secondary" TextWrapping="Wrap"
                                 Text="High agreement with approved templates." />
                    </sc:StrataConfidence.Explanation>
                  </sc:StrataConfidence>
                  <sc:StrataConfidence Label="Root Cause" Confidence="63">
                    <sc:StrataConfidence.Explanation>
                      <TextBlock Classes="caption secondary" TextWrapping="Wrap"
                                 Text="Competing hypotheses remain." />
                    </sc:StrataConfidence.Explanation>
                  </sc:StrataConfidence>
                  <sc:StrataConfidence Label="Anomaly" Confidence="34">
                    <sc:StrataConfidence.Explanation>
                      <TextBlock Classes="caption secondary" TextWrapping="Wrap"
                                 Text="Sparse telemetry; needs more traces." />
                    </sc:StrataConfidence.Explanation>
                  </sc:StrataConfidence>
                </StackPanel>
              </StackPanel>
            </Border>
          </Grid>

          <!-- ── StrataStream ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataStream" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Live generation surface with stream rail and token-rate telemetry." />
              </StackPanel>
              <sc:StrataStream IsStreaming="True" StageText="Synthesizing" TokensPerSecond="31.7">
                <sc:StrataStream.Header>
                  <TextBlock Classes="body-strong" Text="Incident Draft — Generated Response" />
                </sc:StrataStream.Header>
                <sc:StrataStream.Content>
                  <TextBlock TextWrapping="Wrap"
                             Text="Detected elevated memory pressure on worker pool C. Applying autoscale policy and tuning GC thresholds. Early signs show stabilization in p95 latency." />
                </sc:StrataStream.Content>
              </sc:StrataStream>
            </StackPanel>
          </Border>

          <!-- ── StrataThink ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="14">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="StrataThink" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Compact pill that expands into a reasoning trace. Click to reveal AI thinking." />
              </StackPanel>
              <StackPanel Spacing="8">
                <sc:StrataThink Label="Thinking…" IsActive="True">
                  <sc:StrataThink.Content>
                    <TextBlock Classes="secondary" TextWrapping="Wrap"
                               Text="The user is asking about memory pressure on worker pool C. I should check the autoscale policy, GC thresholds, and recent p95 latency data. The incident logs show a correlation between allocation bursts and GC pause spikes in the last 24 hours." />
                  </sc:StrataThink.Content>
                </sc:StrataThink>
                <sc:StrataThink Label="Thought for 4s" IsActive="False">
                  <sc:StrataThink.Content>
                    <TextBlock Classes="secondary" TextWrapping="Wrap"
                               Text="Evaluated three remediation strategies: memory uplift, GC tuning, and horizontal scaling. Selected GC tuning based on cost-efficiency and turnaround time. Confidence: 78%." />
                  </sc:StrataThink.Content>
                </sc:StrataThink>
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- ── StrataTrace + StrataPulse ── -->
          <Grid x:Name="AiTraceGrid" ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card" Padding="24,20">
              <StackPanel Spacing="14">
                <StackPanel Spacing="3">
                  <TextBlock Classes="subtitle" Text="StrataTrace" />
                  <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                             Text="Inline citation badges. Hover or click to reveal source details." />
                </StackPanel>
                <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource Brush.TextSecondary}">
                  <Run Text="Memory pressure on worker pool C exceeded the 85% threshold" />
                </TextBlock>
                <StackPanel Spacing="6">
                  <sc:StrataTrace Index="1" Title="Runbook: Memory Autoscale"
                                  Snippet="When heap exceeds 85%, enable autoscale tier 2 and reduce GC gen-2 budget by 20%."
                                  Origin="runbooks/infra/autoscale.md"
                                  Relevance="94" />
                  <sc:StrataTrace Index="2" Title="Incident IR-4471 Post-mortem"
                                  Snippet="Root cause traced to allocation burst in serializer hot path during peak traffic window."
                                  Origin="incidents/2025/IR-4471.pdf"
                                  Relevance="81" />
                  <sc:StrataTrace Index="3" Title="GC Tuning Guide"
                                  Snippet="Workstation GC mode is not recommended for server workloads exceeding 4 cores."
                                  Origin="docs/perf/gc-tuning.md"
                                  Relevance="67" />
                </StackPanel>
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card" Padding="24,20">
              <StackPanel Spacing="14">
                <StackPanel Spacing="3">
                  <TextBlock Classes="subtitle" Text="StrataPulse" />
                  <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                             Text="Live activity heartbeat. Bar graph shows recent intensity." />
                </StackPanel>
                <StackPanel Spacing="10">
                  <sc:StrataPulse Label="API Calls" Rate="31.2" IsLive="True" />
                  <sc:StrataPulse Label="Token Usage" Rate="4.8" IsLive="True" HeightMax="20" />
                  <sc:StrataPulse Label="Queue Depth" Rate="0" IsLive="False" HeightMax="16" />
                </StackPanel>
              </StackPanel>
            </Border>
          </Grid>

          <!-- ── StrataStepFlow + StrataPromptBar ── -->
          <Grid x:Name="AiStepGrid" ColumnDefinitions="*,16,*">
            <Border Grid.Column="0" Classes="strata-card" Padding="24,20">
              <StackPanel Spacing="14">
                <StackPanel Spacing="3">
                  <TextBlock Classes="subtitle" Text="StrataStepFlow" />
                  <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                             Text="Click stages or arrow-key between steps." />
                </StackPanel>
                <sc:StrataStepFlow CurrentStep="1"
                                   Step0Title="Draft"
                                   Step1Title="Grounding"
                                   Step2Title="Reasoning"
                                   Step3Title="Finalize">
                  <sc:StrataStepFlow.Step0Content>
                    <StackPanel Spacing="4">
                      <TextBlock Classes="body-strong" Text="Draft" />
                      <TextBlock Classes="secondary" TextWrapping="Wrap" Text="Initial response from prompt intent." />
                    </StackPanel>
                  </sc:StrataStepFlow.Step0Content>
                  <sc:StrataStepFlow.Step1Content>
                    <StackPanel Spacing="4">
                      <TextBlock Classes="body-strong" Text="Grounding" />
                      <TextBlock TextWrapping="Wrap" Text="Cross-checked against runbook and metrics." />
                    </StackPanel>
                  </sc:StrataStepFlow.Step1Content>
                  <sc:StrataStepFlow.Step2Content>
                    <StackPanel Spacing="4">
                      <TextBlock Classes="body-strong" Text="Reasoning" />
                      <TextBlock Classes="secondary" TextWrapping="Wrap" Text="Hypotheses ranked by evidence." />
                    </StackPanel>
                  </sc:StrataStepFlow.Step2Content>
                  <sc:StrataStepFlow.Step3Content>
                    <StackPanel Spacing="4">
                      <TextBlock Classes="body-strong" Text="Finalize" />
                      <TextBlock Classes="secondary" TextWrapping="Wrap" Text="Normalized to stakeholder format." />
                    </StackPanel>
                  </sc:StrataStepFlow.Step3Content>
                </sc:StrataStepFlow>
              </StackPanel>
            </Border>
            <Border Grid.Column="2" Classes="strata-card" Padding="24,20">
              <StackPanel Spacing="14">
                <StackPanel Spacing="3">
                  <TextBlock Classes="subtitle" Text="StrataPromptBar" />
                  <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                             Text="Prompt composer with intent switching." />
                </StackPanel>
                <sc:StrataPromptBar Placeholder="Summarize this incident..."
                                    PromptText="Summarize the outage timeline and propose a mitigation plan."
                                    Intent="Summary"
                                    IsBusy="False" />
              </StackPanel>
            </Border>
          </Grid>

          <!-- ── AI Micro Indicators ── -->
          <Border Classes="strata-card" Padding="24,20">
            <StackPanel Spacing="16">
              <StackPanel Spacing="3">
                <TextBlock Classes="subtitle" Text="AI Micro Indicators" />
                <TextBlock Classes="caption tertiary" TextWrapping="Wrap"
                           Text="Provenance mode and token budget helpers." />
              </StackPanel>
              <Grid x:Name="AiMicroGrid" ColumnDefinitions="*,24,*">
                <StackPanel Grid.Column="0" Spacing="6">
                  <TextBlock Classes="caption" FontWeight="SemiBold" Foreground="{DynamicResource Brush.TextSecondary}" Text="StrataCueSwitch" />
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <sc:StrataCueSwitch Mode="Memory" />
                    <sc:StrataCueSwitch Mode="Grounded" />
                    <sc:StrataCueSwitch Mode="Tool" />
                  </StackPanel>
                </StackPanel>
                <StackPanel Grid.Column="2" Spacing="6">
                  <TextBlock Classes="caption" FontWeight="SemiBold" Foreground="{DynamicResource Brush.TextSecondary}" Text="StrataBudgetChip" />
                  <sc:StrataBudgetChip UsedTokens="2480" MaxTokens="8000" />
                  <sc:StrataBudgetChip UsedTokens="7620" MaxTokens="8000" IsEditable="False" />
                </StackPanel>
              </Grid>
            </StackPanel>
          </Border>

        </StackPanel>
      </ScrollViewer>

      <!-- ════════ Page 6: Settings ════════ -->
      <sc:StrataSettingPage x:Name="Page6"
                            IsVisible="False"
                            MaxWidth="920"
                            Classes="page-shell"
                            Header="{Binding Strings[Settings]}"
                            Description="{Binding Strings[Settings.Subtitle]}">

        <!-- ── Appearance tab ── -->
        <TabItem Header="{Binding Strings[Appearance]}">
          <StackPanel Spacing="16" Margin="0,4">

            <!-- Group 1: Theme -->
            <sc:StrataSettingGroup Header="{Binding Strings[Appearance]}"
                                  Description="{Binding Strings[Appearance.Subtitle]}">
              <sc:StrataSetting Header="{Binding Strings[DarkMode]}"
                                Description="{Binding Strings[DarkMode.Desc]}"
                                IsModified="{Binding IsDarkTheme}">
                <ToggleSwitch IsChecked="{Binding IsDarkTheme}" x:Name="ThemeToggle2" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[CompactDensity]}"
                                Description="{Binding Strings[CompactDensity.Desc]}"
                                IsModified="{Binding IsCompactDensity}">
                <ToggleSwitch IsChecked="{Binding IsCompactDensity}" x:Name="DensityToggle2" />
              </sc:StrataSetting>
            </sc:StrataSettingGroup>

            <!-- Group 2: Accessibility -->
            <sc:StrataSettingGroup Header="{Binding Strings[Accessibility]}"
                                  Description="{Binding Strings[Accessibility.Subtitle]}">
              <sc:StrataSetting Header="{Binding Strings[HighContrast]}"
                                Description="{Binding Strings[HighContrast.Desc]}">
                <ToggleSwitch x:Name="HighContrastToggle" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[ReduceMotion]}"
                                Description="{Binding Strings[ReduceMotion.Desc]}">
                <ToggleSwitch x:Name="ReduceMotionToggle" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[FontSize]}"
                                Description="{Binding Strings[FontSize.Desc]}">
                <ComboBox MinWidth="140" SelectedIndex="1">
                  <ComboBoxItem Content="Small" />
                  <ComboBoxItem Content="Medium" />
                  <ComboBoxItem Content="Large" />
                </ComboBox>
              </sc:StrataSetting>
            </sc:StrataSettingGroup>
          </StackPanel>
        </TabItem>

        <!-- ── Notifications tab ── -->
        <TabItem Header="{Binding Strings[Notifications]}">
          <StackPanel Spacing="16" Margin="0,4">

            <!-- Group 1: Alerts -->
            <sc:StrataSettingGroup Header="{Binding Strings[Notifications]}"
                                  Description="{Binding Strings[Notifications.Subtitle]}">
              <sc:StrataSetting x:Name="EmailNotifSetting"
                                Header="{Binding Strings[EnableEmailNotifications]}"
                                Description="{Binding Strings[EnableEmailNotifications.Desc]}"
                                IsModified="True">
                <CheckBox x:Name="EmailNotifCheck" IsChecked="True" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[EnablePushNotifications]}"
                                Description="{Binding Strings[EnablePushNotifications.Desc]}">
                <CheckBox />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[WeeklyDigest]}"
                                Description="{Binding Strings[WeeklyDigest.Desc]}">
                <CheckBox IsChecked="True" />
              </sc:StrataSetting>
            </sc:StrataSettingGroup>

            <!-- Group 2: Data & Privacy -->
            <sc:StrataSettingGroup Header="{Binding Strings[DataPrivacy]}"
                                  Description="{Binding Strings[DataPrivacy.Subtitle]}">
              <sc:StrataSetting x:Name="DiagnosticsSetting"
                                Header="{Binding Strings[SendDiagnostics]}"
                                Description="{Binding Strings[SendDiagnostics.Desc]}"
                                IsModified="True">
                <ToggleSwitch x:Name="DiagnosticsToggle" IsChecked="True" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[PersonalisedAds]}"
                                Description="{Binding Strings[PersonalisedAds.Desc]}">
                <ToggleSwitch />
              </sc:StrataSetting>
            </sc:StrataSettingGroup>
          </StackPanel>
        </TabItem>

        <!-- ── Region & Language tab ── -->
        <TabItem Header="{Binding Strings[RegionLanguage]}">
          <StackPanel Spacing="16" Margin="0,4">

            <!-- Group 1: Locale -->
            <sc:StrataSettingGroup Header="{Binding Strings[RegionLanguage]}"
                                  Description="{Binding Strings[RegionLanguage.Subtitle]}">
              <sc:StrataSetting Header="{Binding Strings[Language]}"
                                Description="{Binding Strings[Language.Desc]}">
                <ComboBox ItemsSource="{Binding Languages}"
                          SelectedIndex="{Binding SelectedLanguageIndex}"
                          PlaceholderText="{Binding Strings[SelectLanguage]}"
                          MinWidth="200" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[Timezone]}"
                                Description="{Binding Strings[Timezone.Desc]}">
                <ComboBox PlaceholderText="{Binding Strings[SelectTimezone]}"
                          MinWidth="200">
                  <ComboBoxItem Content="UTC-8 Pacific" />
                  <ComboBoxItem Content="UTC-5 Eastern" />
                  <ComboBoxItem Content="UTC+0 London" />
                  <ComboBoxItem Content="UTC+1 Berlin" />
                  <ComboBoxItem Content="UTC+9 Tokyo" />
                </ComboBox>
              </sc:StrataSetting>
            </sc:StrataSettingGroup>

            <!-- Group 2: Date & Time -->
            <sc:StrataSettingGroup Header="{Binding Strings[DateTimeFormat]}"
                                  Description="{Binding Strings[DateTimeFormat.Subtitle]}">
              <sc:StrataSetting Header="{Binding Strings[DateFormat]}"
                                Description="{Binding Strings[DateFormat.Desc]}">
                <ComboBox MinWidth="180" SelectedIndex="0">
                  <ComboBoxItem Content="MM/DD/YYYY" />
                  <ComboBoxItem Content="DD/MM/YYYY" />
                  <ComboBoxItem Content="YYYY-MM-DD" />
                </ComboBox>
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[Use24Hour]}"
                                Description="{Binding Strings[Use24Hour.Desc]}">
                <ToggleSwitch />
              </sc:StrataSetting>
            </sc:StrataSettingGroup>

            <!-- Group 3: Startup -->
            <sc:StrataSettingGroup Header="{Binding Strings[Startup]}"
                                  Description="{Binding Strings[Startup.Subtitle]}">
              <sc:StrataSetting Header="{Binding Strings[RestoreSession]}"
                                Description="{Binding Strings[RestoreSession.Desc]}">
                <ToggleSwitch IsChecked="True" />
              </sc:StrataSetting>
              <sc:StrataSetting Header="{Binding Strings[CheckUpdates]}"
                                Description="{Binding Strings[CheckUpdates.Desc]}">
                <CheckBox IsChecked="True" />
              </sc:StrataSetting>
            </sc:StrataSettingGroup>
          </StackPanel>
        </TabItem>
      </sc:StrataSettingPage>

      <!-- ════════ Page 7: Chat Experience ════════ -->
      <Grid x:Name="Page7"
            IsVisible="False"
            Classes="page-shell"
            MaxWidth="1240"
            RowDefinitions="Auto,16,*">

        <Border Grid.Row="0"
                BorderBrush="{DynamicResource Brush.AccentDefault}"
                BorderThickness="3,0,0,0"
                Padding="16,0,0,0">
          <StackPanel Spacing="4">
            <TextBlock Classes="headline" Text="Chat Experience" />
            <TextBlock Classes="secondary" Text="Full mocked conversation surface with streaming, tools, context, and follow-up composer." />
          </StackPanel>
        </Border>

        <Grid x:Name="ChatLayout" Grid.Row="2" ColumnDefinitions="2.6*,16,1.4*" RowDefinitions="*">

          <!-- Primary conversation surface -->
          <Border x:Name="ChatMainCard"
                  Grid.Column="0"
              Background="Transparent"
              BorderBrush="Transparent"
              BorderThickness="0"
              CornerRadius="0"
                  Padding="0"
                  ClipToBounds="True">
            <sc:StrataChatShell x:Name="MainChatShell"
                               IsOnline="True"
                               PresenceText="Connected"
                               VerticalAlignment="Stretch">

              <sc:StrataChatShell.Header>
                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                  <Border Width="24" Height="24" CornerRadius="7"
                          Background="{DynamicResource Brush.AccentGradient}">
                    <TextBlock Text="S" FontSize="12" FontWeight="Bold"
                               Foreground="{DynamicResource Brush.TextOnAccent}"
                               HorizontalAlignment="Center" VerticalAlignment="Center" />
                  </Border>
                  <StackPanel Spacing="0">
                    <TextBlock Classes="body-strong" Text="Strata Assistant" />
                    <TextBlock Classes="caption tertiary" Text="incident-room / prod / IR-4471" />
                  </StackPanel>
                </StackPanel>
              </sc:StrataChatShell.Header>

              <sc:StrataChatShell.Transcript>
                <StackPanel x:Name="LiveTranscript" Spacing="8" />
              </sc:StrataChatShell.Transcript>

              <sc:StrataChatShell.Composer>
                <sc:StrataChatComposer x:Name="LiveComposer"
                                      Placeholder="Send a message to start the conversation…"
                                      Models="{Binding AiModels}"
                                      SelectedModel="GPT-5.3-Codex"
                                      QualityLevels="{Binding AiQualityLevels}"
                                      SelectedQuality="Extra High"
                                      AvailableAgents="{Binding AvailableAgents}"
                                      AvailableSkills="{Binding AvailableSkills}"
                                      SkillItems="{Binding LiveAiSkills}"
                                      SuggestionA="Summarize incident"
                                      SuggestionB="Draft status update"
                                      SuggestionC="Create rollout checklist" />
              </sc:StrataChatShell.Composer>

            </sc:StrataChatShell>
          </Border>

          <!-- Context / side intelligence -->
          <ScrollViewer x:Name="ChatSideHost"
                        Grid.Column="2"
                        HorizontalScrollBarVisibility="Disabled"
                        VerticalScrollBarVisibility="Auto">
            <StackPanel x:Name="ChatSidePanel" Spacing="16">

              <Border Classes="strata-card" Padding="20,16">
                <StackPanel Spacing="12">
                  <TextBlock Classes="subtitle" Text="Session Context" />
                  <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" />
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.TextTertiary}" Text="Workspace" />
                  <TextBlock Text="incident-room / prod" />
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.TextTertiary}" Text="Conversation" />
                  <TextBlock Text="IR-4471 remediation thread" />
                  <TextBlock Classes="caption" Foreground="{DynamicResource Brush.TextTertiary}" Text="Grounding" />
                  <TextBlock Text="Enabled (4 linked sources)" />
                </StackPanel>
              </Border>

              <Border Classes="strata-card" Padding="20,16">
                <StackPanel Spacing="12">
                  <TextBlock Classes="subtitle" Text="Confidence" />
                  <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" />
                  <sc:StrataConfidence x:Name="LiveConfRootCause" Label="Root Cause" Confidence="88" />
                  <sc:StrataConfidence x:Name="LiveConfMitigation" Label="Mitigation Plan" Confidence="81" />
                  <sc:StrataConfidence x:Name="LiveConfImpact" Label="Customer Impact" Confidence="74" />
                </StackPanel>
              </Border>

              <Border Classes="strata-card" Padding="20,16">
                <StackPanel Spacing="12">
                  <TextBlock Classes="subtitle" Text="Live Signals" />
                  <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" />
                  <sc:StrataPulse x:Name="LivePulse" Label="Token Throughput" Rate="0" IsLive="True" />
                  <sc:StrataBudgetChip x:Name="LiveBudget" UsedTokens="0" MaxTokens="12000" />
                </StackPanel>
              </Border>

              <Border Classes="strata-card" Padding="20,16">
                <StackPanel Spacing="12">
                  <TextBlock Classes="subtitle" Text="Evidence" />
                  <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" />
                  <sc:StrataTrace Index="1" Title="IR-4471 Summary"
                                  Snippet="Latency spike correlated with serializer allocation bursts in worker pool C."
                                  Origin="incidents/IR-4471.md"
                                  Relevance="93" />
                  <sc:StrataTrace Index="2" Title="Autoscale Runbook"
                                  Snippet="Enable staged rollout with p95 + GC pause rollback thresholds."
                                  Origin="runbooks/infra/autoscale.md"
                                  Relevance="87" />
                </StackPanel>
              </Border>

              <Border Classes="strata-card" Padding="20,16">
                <StackPanel Spacing="12">
                  <TextBlock Classes="subtitle" Text="Suggested Next" />
                  <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" />
                  <Button Classes="subtle" Content="Create rollout checklist" HorizontalAlignment="Stretch" />
                  <Button Classes="subtle" Content="Generate stakeholder email" HorizontalAlignment="Stretch" />
                  <Button Classes="subtle" Content="Export conversation" HorizontalAlignment="Stretch" />
                </StackPanel>
              </Border>

            </StackPanel>
          </ScrollViewer>
        </Grid>
      </Grid>

    </Panel>
  </DockPanel>

</Window>
