<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="using:StrataTheme.Controls">

  <Styles.Resources>
    <ResourceDictionary>
      <ResourceDictionary.ThemeDictionaries>
        <ResourceDictionary x:Key="Light">
          <SolidColorBrush x:Key="Brush.TerminalPreviewSurface">#FFF6F8FA</SolidColorBrush>
          <SolidColorBrush x:Key="Brush.TerminalPreviewPrompt">#1B7A3F</SolidColorBrush>
          <SolidColorBrush x:Key="Brush.TerminalPreviewCommand">#1E293B</SolidColorBrush>
          <SolidColorBrush x:Key="Brush.TerminalPreviewOutput">#334155</SolidColorBrush>
        </ResourceDictionary>
        <ResourceDictionary x:Key="Dark">
          <SolidColorBrush x:Key="Brush.TerminalPreviewSurface">#FF0C0C0C</SolidColorBrush>
          <SolidColorBrush x:Key="Brush.TerminalPreviewPrompt">#FF6A9955</SolidColorBrush>
          <SolidColorBrush x:Key="Brush.TerminalPreviewCommand">#FFD4D4D4</SolidColorBrush>
          <SolidColorBrush x:Key="Brush.TerminalPreviewOutput">#FFCCCCCC</SolidColorBrush>
        </ResourceDictionary>
      </ResourceDictionary.ThemeDictionaries>

      <ControlTheme x:Key="{x:Type controls:StrataTerminalPreview}" TargetType="controls:StrataTerminalPreview">
        <Setter Property="Focusable" Value="True" />
        <Setter Property="HorizontalAlignment" Value="Stretch" />
        <Setter Property="VerticalAlignment" Value="Top" />
        <Setter Property="Template">
          <ControlTemplate>
            <Panel>
              <Border Name="PART_FocusRing"
                      CornerRadius="10"
                      BorderThickness="2"
                      BorderBrush="Transparent"
                      Margin="-2"
                      IsHitTestVisible="False" />

              <Border Name="PART_Root"
                      Background="{DynamicResource Brush.Surface0}"
                      BorderBrush="{DynamicResource Brush.BorderSubtle}"
                      BorderThickness="1"
                      CornerRadius="8"
                      ClipToBounds="True">
                <Border.Transitions>
                  <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.14" />
                    <BrushTransition Property="BorderBrush" Duration="0:0:0.14" />
                    <BoxShadowsTransition Property="BoxShadow" Duration="0:0:0.18" />
                  </Transitions>
                </Border.Transitions>

              <StackPanel Spacing="0">
                <!-- Animated status bar -->
                <Border Name="PART_Stratum"
                        Height="2"
                        Background="{DynamicResource Brush.AccentGradient}"
                        Opacity="0.75" />

                <!-- Header: status dot + tool name + status pill + collapse -->
                <Border Name="PART_Header"
                        Cursor="Hand"
                        Padding="10,6"
                        Background="Transparent">
                  <Grid ColumnDefinitions="Auto,8,*,8,Auto">
                    <Border Name="PART_StateDot"
                            Width="6" Height="6"
                            CornerRadius="3"
                            VerticalAlignment="Center"
                            Background="{DynamicResource Brush.AccentDefault}" />

                    <TextBlock Grid.Column="2"
                               Text="{TemplateBinding ToolName}"
                               FontSize="12"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis" />

                    <Border Name="PART_StatusPill"
                            Grid.Column="4"
                            Padding="7,2"
                            CornerRadius="999"
                            Background="{DynamicResource Brush.AccentSubtle}">
                      <TextBlock Name="PART_StatusText"
                                 Text="{Binding StatusText, RelativeSource={RelativeSource TemplatedParent}}"
                                 FontSize="10"
                                 FontWeight="SemiBold"
                                 Foreground="{DynamicResource Brush.AccentDefault}" />
                    </Border>
                  </Grid>
                </Border>

                <!-- Terminal body -->
                <Border Name="PART_TerminalBody"
                        ClipToBounds="True"
                        MaxHeight="0"
                        Opacity="0"
                        Padding="0"
                        RenderTransformOrigin="0.5,0"
                        RenderTransform="translateY(-4px) scaleY(0.96)">
                  <Border.Transitions>
                    <Transitions>
                      <DoubleTransition Property="MaxHeight" Duration="0:0:0.26" Easing="CubicEaseOut" />
                      <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                      <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.22" Easing="CubicEaseOut" />
                    </Transitions>
                  </Border.Transitions>

                    <Border Background="{DynamicResource Brush.TerminalPreviewSurface}"
                          CornerRadius="0,0,6,6"
                          Margin="4,0,4,4"
                          Padding="12,8">
                    <StackPanel Spacing="6">
                      <!-- Command line -->
                      <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="$"
                                   FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                   FontSize="12"
                                   Foreground="{DynamicResource Brush.TerminalPreviewPrompt}"
                                   VerticalAlignment="Top" />
                        <TextBlock Text="{TemplateBinding Command}"
                                   FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                   FontSize="12"
                                   Foreground="{DynamicResource Brush.TerminalPreviewCommand}"
                                   TextWrapping="Wrap" />
                      </StackPanel>

                      <!-- Output area -->
                      <ScrollViewer Name="PART_OutputScroll"
                                    HorizontalScrollBarVisibility="Disabled"
                                    VerticalScrollBarVisibility="Auto"
                                    MaxHeight="260">
                        <TextBlock Name="PART_OutputText"
                                   Text="{TemplateBinding Output}"
                                   FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                   FontSize="11.5"
                                   Foreground="{DynamicResource Brush.TerminalPreviewOutput}"
                                   TextWrapping="Wrap"
                                   LineHeight="18" />
                      </ScrollViewer>
                    </StackPanel>
                  </Border>
                </Border>
                </StackPanel>
              </Border>
            </Panel>
          </ControlTemplate>
        </Setter>

        <!-- Expanded state: show terminal body -->
        <Style Selector="^:expanded /template/ Border#PART_TerminalBody">
          <Setter Property="MaxHeight" Value="680" />
          <Setter Property="Opacity" Value="1" />
          <Setter Property="RenderTransform" Value="translateY(0) scaleY(1)" />
        </Style>

        <!-- Status-specific styling: InProgress -->
        <Style Selector="^:inprogress /template/ Border#PART_StateDot">
          <Setter Property="Background" Value="{DynamicResource Brush.AccentDefault}" />
        </Style>
        <Style Selector="^:inprogress /template/ Border#PART_StatusPill">
          <Setter Property="Background" Value="{DynamicResource Brush.AccentSubtle}" />
        </Style>
        <Style Selector="^:inprogress /template/ TextBlock#PART_StatusText">
          <Setter Property="Foreground" Value="{DynamicResource Brush.AccentDefault}" />
        </Style>
        <Style Selector="^:inprogress /template/ Border#PART_Stratum">
          <Setter Property="Background" Value="{DynamicResource Brush.AccentGradient}" />
          <Style.Animations>
            <Animation Duration="0:0:1.1" IterationCount="Infinite">
              <KeyFrame Cue="0%">
                <Setter Property="Opacity" Value="0.55" />
              </KeyFrame>
              <KeyFrame Cue="50%">
                <Setter Property="Opacity" Value="1" />
              </KeyFrame>
              <KeyFrame Cue="100%">
                <Setter Property="Opacity" Value="0.55" />
              </KeyFrame>
            </Animation>
          </Style.Animations>
        </Style>

        <!-- Status-specific styling: Completed -->
        <Style Selector="^:completed /template/ Border#PART_StateDot">
          <Setter Property="Background" Value="{DynamicResource Brush.SuccessDefault}" />
        </Style>
        <Style Selector="^:completed /template/ Border#PART_StatusPill">
          <Setter Property="Background" Value="{DynamicResource Brush.Surface1}" />
        </Style>
        <Style Selector="^:completed /template/ TextBlock#PART_StatusText">
          <Setter Property="Foreground" Value="{DynamicResource Brush.SuccessDefault}" />
        </Style>
        <Style Selector="^:completed /template/ Border#PART_Stratum">
          <Setter Property="Background" Value="{DynamicResource Brush.SuccessDefault}" />
          <Setter Property="Opacity" Value="0.85" />
        </Style>

        <!-- Status-specific styling: Failed -->
        <Style Selector="^:failed /template/ Border#PART_StateDot">
          <Setter Property="Background" Value="{DynamicResource Brush.DangerDefault}" />
        </Style>
        <Style Selector="^:failed /template/ Border#PART_StatusPill">
          <Setter Property="Background" Value="{DynamicResource Brush.DangerSubtle}" />
        </Style>
        <Style Selector="^:failed /template/ TextBlock#PART_StatusText">
          <Setter Property="Foreground" Value="{DynamicResource Brush.DangerDefault}" />
        </Style>
        <Style Selector="^:failed /template/ Border#PART_Stratum">
          <Setter Property="Background" Value="{DynamicResource Brush.DangerDefault}" />
          <Setter Property="Opacity" Value="0.85" />
        </Style>

        <!-- Hover effect -->
        <Style Selector="^:pointerover /template/ Border#PART_Root">
          <Setter Property="BorderBrush" Value="{DynamicResource Brush.BorderDefault}" />
          <Setter Property="Background" Value="{DynamicResource Brush.Surface1}" />
          <Setter Property="BoxShadow" Value="0 2 8 0 #12000000" />
        </Style>

        <Style Selector="^:focus-visible /template/ Border#PART_FocusRing">
          <Setter Property="BorderBrush" Value="{DynamicResource Brush.AccentGradient}" />
        </Style>
      </ControlTheme>
    </ResourceDictionary>
  </Styles.Resources>
</Styles>
