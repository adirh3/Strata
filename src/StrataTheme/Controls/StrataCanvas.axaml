<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="using:StrataTheme.Controls">

  <!-- ═══════════════════════════════════════════════════════════
       StrataCanvas
       Rich-content artifact canvas with stream rail, version nav,
       status pulse, layered surfaces, and chat-aware layout.
       ═══════════════════════════════════════════════════════════ -->

  <Styles.Resources>
    <ResourceDictionary>

      <ControlTheme x:Key="{x:Type controls:StrataCanvas}" TargetType="controls:StrataCanvas">
        <Setter Property="Focusable" Value="True" />
        <Setter Property="Background" Value="{DynamicResource Brush.SurfaceCard}" />
        <Setter Property="BorderBrush" Value="{DynamicResource Brush.BorderSubtle}" />
        <Setter Property="BorderThickness" Value="{DynamicResource Stroke.Thin}" />
        <Setter Property="CornerRadius" Value="{DynamicResource Radius.Interactive}" />
        <Setter Property="ClipToBounds" Value="True" />
        <Setter Property="Template">
          <ControlTemplate>
            <Border Name="PART_Root"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}"
                    BoxShadow="0 1 3 0 #08000000"
                    ClipToBounds="True">
              <Border.Transitions>
                <Transitions>
                  <BrushTransition Property="Background" Duration="0:0:0.2" />
                  <BrushTransition Property="BorderBrush" Duration="0:0:0.15" />
                  <BoxShadowsTransition Property="BoxShadow" Duration="0:0:0.24" />
                </Transitions>
              </Border.Transitions>

              <DockPanel>

                <!-- ── Stream rail: scanning accent bar (like StrataStream) ── -->
                <Border Name="PART_StreamTrack"
                        DockPanel.Dock="Top"
                        Height="2.5"
                        Background="{DynamicResource Brush.SubtleHover}"
                        ClipToBounds="True">
                  <Border Name="PART_StreamBar"
                          Height="2.5"
                          Width="80"
                          HorizontalAlignment="Left"
                          Background="{DynamicResource Brush.StratumLine}"
                          Opacity="0" />
                </Border>

                <!-- ── Title bar ── -->
                <Border Name="PART_TitleBar"
                        DockPanel.Dock="Top"
                        Padding="14,8,8,8"
                        Background="Transparent">
                  <Border.Transitions>
                    <Transitions>
                      <BrushTransition Property="Background" Duration="0:0:0.16" />
                    </Transitions>
                  </Border.Transitions>
                  <DockPanel LastChildFill="True">

                    <!-- Right side: version nav + toolbar + close -->
                    <StackPanel DockPanel.Dock="Right"
                                Orientation="Horizontal"
                                Spacing="2"
                                VerticalAlignment="Center">

                      <!-- Toolbar slot -->
                      <ContentPresenter Name="PART_ToolBarPresenter"
                                        Content="{TemplateBinding ToolBar}"
                                        IsVisible="False"
                                        VerticalAlignment="Center" />
                      <Border Name="PART_ToolBarSep"
                              Width="1" Height="14"
                              Margin="4,0"
                              Background="{DynamicResource Brush.BorderSubtle}"
                              IsVisible="False" />

                      <!-- Version navigation -->
                      <Border Name="PART_VersionNav"
                              IsVisible="False"
                              Background="{DynamicResource Brush.ControlDefault}"
                              BorderBrush="{DynamicResource Brush.ControlElevationBorder}"
                              BorderThickness="{DynamicResource Stroke.Thin}"
                              CornerRadius="6"
                              Padding="1">
                        <Border.Transitions>
                          <Transitions>
                            <BrushTransition Property="Background" Duration="0:0:0.12" />
                          </Transitions>
                        </Border.Transitions>
                        <StackPanel Orientation="Horizontal" Spacing="0">
                          <Button Name="PART_PrevButton" Classes="subtle"
                                  Padding="5,2" MinHeight="0" MinWidth="0" CornerRadius="4">
                            <TextBlock Text="◀" FontSize="8"
                                       Foreground="{DynamicResource Brush.TextTertiary}"
                                       VerticalAlignment="Center" />
                          </Button>
                          <TextBlock Name="PART_VersionLabel"
                                     Text="{Binding Version, RelativeSource={RelativeSource TemplatedParent}, StringFormat='{}{0}'}"
                                     FontSize="11" FontWeight="SemiBold"
                                     Foreground="{DynamicResource Brush.TextSecondary}"
                                     VerticalAlignment="Center"
                                     Margin="5,0" />
                          <TextBlock Text="/"
                                     FontSize="11"
                                     Foreground="{DynamicResource Brush.TextTertiary}"
                                     VerticalAlignment="Center" />
                          <TextBlock Name="PART_VersionTotal"
                                     Text="{Binding VersionCount, RelativeSource={RelativeSource TemplatedParent}, StringFormat='{}{0}'}"
                                     FontSize="11"
                                     Foreground="{DynamicResource Brush.TextTertiary}"
                                     VerticalAlignment="Center"
                                     Margin="0,0,5,0" />
                          <Button Name="PART_NextButton" Classes="subtle"
                                  Padding="5,2" MinHeight="0" MinWidth="0" CornerRadius="4">
                            <TextBlock Text="▶" FontSize="8"
                                       Foreground="{DynamicResource Brush.TextTertiary}"
                                       VerticalAlignment="Center" />
                          </Button>
                        </StackPanel>
                      </Border>

                      <Border Name="PART_VersionSep"
                              Width="1" Height="14"
                              Margin="4,0"
                              Background="{DynamicResource Brush.BorderSubtle}"
                              IsVisible="False" />

                      <!-- Close button -->
                      <Button Name="PART_CloseButton"
                              Classes="subtle"
                              Padding="6,4" MinHeight="0" MinWidth="0"
                              CornerRadius="6"
                              ToolTip.Tip="Close">
                        <TextBlock Text="✕" FontSize="10"
                                   Foreground="{DynamicResource Brush.TextTertiary}" />
                      </Button>
                    </StackPanel>

                    <!-- Left side: status dot + icon + title + subtitle -->
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                      <Border Name="PART_StatusDot"
                              Width="7" Height="7"
                              CornerRadius="3.5"
                              Background="{DynamicResource Brush.TextTertiary}"
                              VerticalAlignment="Center">
                        <Border.Transitions>
                          <Transitions>
                            <BrushTransition Property="Background" Duration="0:0:0.2" />
                          </Transitions>
                        </Border.Transitions>
                      </Border>
                      <ContentPresenter Name="PART_IconPresenter"
                                        Content="{TemplateBinding Icon}"
                                        IsVisible="False"
                                        VerticalAlignment="Center" />
                      <StackPanel Spacing="0" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                          <TextBlock Name="PART_Title"
                                     Text="{TemplateBinding Title}"
                                     FontSize="13"
                                     FontWeight="SemiBold"
                                     Foreground="{DynamicResource Brush.TextPrimary}" />
                          <TextBlock Name="PART_Subtitle"
                                     Text="{TemplateBinding Subtitle}"
                                     FontSize="11"
                                     Foreground="{DynamicResource Brush.TextTertiary}"
                                     VerticalAlignment="Center"
                                     IsVisible="False" />
                        </StackPanel>
                      </StackPanel>
                    </StackPanel>

                  </DockPanel>
                </Border>

                <!-- Title bar keyline -->
                <Border DockPanel.Dock="Top"
                        Height="1"
                        Background="{DynamicResource Brush.BorderSubtle}"
                        Opacity="0.5" />

                <!-- Footer docked before content fills remaining space -->
                <Border Name="PART_FooterSeparator"
                        DockPanel.Dock="Bottom"
                        Height="1"
                        Background="{DynamicResource Brush.BorderSubtle}"
                        Opacity="0.5"
                        IsVisible="False" />
                <Border Name="PART_Footer"
                        DockPanel.Dock="Bottom"
                        Padding="14,7,14,8"
                        Background="Transparent"
                        IsVisible="False">
                  <ContentPresenter Content="{TemplateBinding Footer}" />
                </Border>

                <!-- Main content: elevated inner surface -->
                <Border Name="PART_ContentHost"
                        Background="{DynamicResource Brush.Surface1}"
                        Margin="6,6,6,6"
                        CornerRadius="7"
                        BorderBrush="{DynamicResource Brush.BorderSubtle}"
                        BorderThickness="0"
                        ClipToBounds="True">
                  <Border.Transitions>
                    <Transitions>
                      <BrushTransition Property="Background" Duration="0:0:0.16" />
                    </Transitions>
                  </Border.Transitions>
                  <ScrollViewer VerticalScrollBarVisibility="Auto"
                                HorizontalScrollBarVisibility="Disabled">
                    <ContentPresenter Name="PART_ContentPresenter"
                                      Content="{TemplateBinding Content}"
                                      Margin="14,10,14,10" />
                  </ScrollViewer>
                </Border>

              </DockPanel>
            </Border>
          </ControlTemplate>
        </Setter>

        <!-- ── Visibility: open / closed ── -->
        <Style Selector="^:closed">
          <Setter Property="IsVisible" Value="False" />
        </Style>

        <!-- ── Generating: accent stream rail + pulsing status dot ── -->
        <Style Selector="^:generating /template/ Border#PART_StatusDot">
          <Setter Property="Background" Value="{DynamicResource Brush.AccentDefault}" />
        </Style>
        <Style Selector="^:generating /template/ Border#PART_StreamTrack">
          <Setter Property="Background" Value="{DynamicResource Brush.AccentSubtle}" />
        </Style>

        <!-- ── Ready: neutral status dot ── -->
        <Style Selector="^:ready /template/ Border#PART_StatusDot">
          <Setter Property="Background" Value="{DynamicResource Brush.SuccessDefault}" />
        </Style>

        <!-- ── Subtitle visibility ── -->
        <Style Selector="^:has-subtitle /template/ TextBlock#PART_Subtitle">
          <Setter Property="IsVisible" Value="True" />
        </Style>

        <!-- ── Icon visibility ── -->
        <Style Selector="^:has-icon /template/ ContentPresenter#PART_IconPresenter">
          <Setter Property="IsVisible" Value="True" />
        </Style>

        <!-- ── Toolbar visibility ── -->
        <Style Selector="^:has-toolbar /template/ ContentPresenter#PART_ToolBarPresenter">
          <Setter Property="IsVisible" Value="True" />
        </Style>
        <Style Selector="^:has-toolbar /template/ Border#PART_ToolBarSep">
          <Setter Property="IsVisible" Value="True" />
        </Style>

        <!-- ── Footer visibility ── -->
        <Style Selector="^:has-footer /template/ Border#PART_Footer">
          <Setter Property="IsVisible" Value="True" />
        </Style>
        <Style Selector="^:has-footer /template/ Border#PART_FooterSeparator">
          <Setter Property="IsVisible" Value="True" />
        </Style>
        <!-- Footer has no inner content margin when present (remove bottom margin from content host) -->
        <Style Selector="^:has-footer /template/ Border#PART_ContentHost">
          <Setter Property="Margin" Value="6,6,6,0" />
          <Setter Property="CornerRadius" Value="7,7,0,0" />
        </Style>

        <!-- ── Version nav visibility ── -->
        <Style Selector="^:has-versions /template/ Border#PART_VersionNav">
          <Setter Property="IsVisible" Value="True" />
        </Style>
        <Style Selector="^:has-versions /template/ Border#PART_VersionSep">
          <Setter Property="IsVisible" Value="True" />
        </Style>

        <!-- ── Close button hidden when ShowCloseButton=False ── -->
        <Style Selector="^[ShowCloseButton=False] /template/ Button#PART_CloseButton">
          <Setter Property="IsVisible" Value="False" />
        </Style>
        <!-- Also hide the version separator when no close button -->
        <Style Selector="^[ShowCloseButton=False] /template/ Border#PART_VersionSep">
          <Setter Property="IsVisible" Value="False" />
        </Style>

        <!-- ── Hover: promote surface + strengthen border ── -->
        <Style Selector="^:pointerover /template/ Border#PART_Root">
          <Setter Property="Background" Value="{DynamicResource Brush.SurfaceCardHover}" />
          <Setter Property="BorderBrush" Value="{DynamicResource Brush.BorderDefault}" />
          <Setter Property="BoxShadow" Value="0 4 16 0 #14000000" />
        </Style>

        <!-- ── Focus ── -->
        <Style Selector="^:focus-visible /template/ Border#PART_Root">
          <Setter Property="BorderBrush" Value="{DynamicResource Brush.AccentDefault}" />
          <Setter Property="BoxShadow" Value="0 0 0 2 #30818CF8" />
        </Style>

      </ControlTheme>

    </ResourceDictionary>
  </Styles.Resources>
</Styles>
