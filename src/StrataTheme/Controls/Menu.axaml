<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:strata="using:StrataTheme">

  <!-- ═══════════════════════════════════════════════════════════
       STRATA UI – Menu, ContextMenu, MenuFlyout, Flyout, MenuItem
       Full custom templates for polished menu experience
       ═══════════════════════════════════════════════════════════ -->

  <Styles.Resources>
    <ResourceDictionary>

      <!-- ── ContextMenu ── -->
      <ControlTheme x:Key="{x:Type ContextMenu}" TargetType="ContextMenu">
        <Setter Property="(strata:OverlayAnimationHelper.AnimateOpen)" Value="True" />
        <Setter Property="Background" Value="{DynamicResource Brush.SurfaceOverlay}" />
        <Setter Property="BorderBrush" Value="{DynamicResource Brush.BorderDefault}" />
        <Setter Property="BorderThickness" Value="{DynamicResource Stroke.Thin}" />
        <Setter Property="CornerRadius" Value="{DynamicResource Radius.Interactive}" />
        <Setter Property="Padding" Value="3" />
        <Setter Property="MinWidth" Value="160" />
        <Setter Property="MaxWidth" Value="300" />
        <Setter Property="FontFamily" Value="{DynamicResource Font.Family}" />
        <Setter Property="FontSize" Value="{DynamicResource Font.SizeBody}" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="Template">
          <ControlTemplate>
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}"
                    Padding="{TemplateBinding Padding}"
                    Margin="16"
                    BoxShadow="0 16 48 -8 #30000000, 0 6 16 0 #18000000, 0 0 0 1 #0C000000"
                    RenderTransformOrigin="0.5,0"
                    RenderTransform="scale(1)"
                    Opacity="1">
              <Border.Transitions>
                <Transitions>
                  <BoxShadowsTransition Property="BoxShadow" Duration="0:0:0.18" />
                </Transitions>
              </Border.Transitions>
              <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Auto"
                            MaxHeight="420">
                <ItemsPresenter Name="PART_ItemsPresenter"
                                ItemsPanel="{TemplateBinding ItemsPanel}" />
              </ScrollViewer>
            </Border>
          </ControlTemplate>
        </Setter>
      </ControlTheme>

      <!-- ── MenuFlyoutPresenter (hosts MenuFlyout items) ── -->
      <ControlTheme x:Key="{x:Type MenuFlyoutPresenter}" TargetType="MenuFlyoutPresenter">
        <Setter Property="(strata:OverlayAnimationHelper.AnimateOpen)" Value="True" />
        <Setter Property="Background" Value="{DynamicResource Brush.SurfaceOverlay}" />
        <Setter Property="BorderBrush" Value="{DynamicResource Brush.BorderDefault}" />
        <Setter Property="BorderThickness" Value="{DynamicResource Stroke.Thin}" />
        <Setter Property="CornerRadius" Value="{DynamicResource Radius.Interactive}" />
        <Setter Property="Padding" Value="3" />
        <Setter Property="MinWidth" Value="160" />
        <Setter Property="MaxWidth" Value="300" />
        <Setter Property="FontFamily" Value="{DynamicResource Font.Family}" />
        <Setter Property="FontSize" Value="{DynamicResource Font.SizeBody}" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="Template">
          <ControlTemplate>
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}"
                    Padding="{TemplateBinding Padding}"
                    Margin="16"
                    BoxShadow="0 16 48 -8 #30000000, 0 6 16 0 #18000000, 0 0 0 1 #0C000000">
              <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Auto"
                            MaxHeight="420">
                <ItemsPresenter Name="PART_ItemsPresenter"
                                ItemsPanel="{TemplateBinding ItemsPanel}" />
              </ScrollViewer>
            </Border>
          </ControlTemplate>
        </Setter>
      </ControlTheme>

      <!-- ── FlyoutPresenter (hosts non-menu Flyout content) ── -->
      <ControlTheme x:Key="{x:Type FlyoutPresenter}" TargetType="FlyoutPresenter">
        <Setter Property="(strata:OverlayAnimationHelper.AnimateOpen)" Value="True" />
        <Setter Property="Background" Value="{DynamicResource Brush.SurfaceOverlay}" />
        <Setter Property="BorderBrush" Value="{DynamicResource Brush.BorderDefault}" />
        <Setter Property="BorderThickness" Value="{DynamicResource Stroke.Thin}" />
        <Setter Property="CornerRadius" Value="{DynamicResource Radius.Interactive}" />
        <Setter Property="Padding" Value="{DynamicResource Padding.Control}" />
        <Setter Property="MinWidth" Value="64" />
        <Setter Property="MaxWidth" Value="460" />
        <Setter Property="FontFamily" Value="{DynamicResource Font.Family}" />
        <Setter Property="FontSize" Value="{DynamicResource Font.SizeBody}" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="Template">
          <ControlTemplate>
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}"
                    Padding="{TemplateBinding Padding}"
                    Margin="16"
                    BoxShadow="0 16 48 -8 #30000000, 0 6 16 0 #18000000, 0 0 0 1 #0C000000">
              <ContentPresenter Name="PART_ContentPresenter"
                                Content="{TemplateBinding Content}"
                                ContentTemplate="{TemplateBinding ContentTemplate}" />
            </Border>
          </ControlTemplate>
        </Setter>
      </ControlTheme>

      <!-- ── MenuItem ── -->
      <ControlTheme x:Key="{x:Type MenuItem}" TargetType="MenuItem">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="Padding" Value="8,4,8,4" />
        <Setter Property="MinHeight" Value="26" />
        <Setter Property="CornerRadius" Value="{DynamicResource Radius.Base}" />
        <Setter Property="FontFamily" Value="{DynamicResource Font.Family}" />
        <Setter Property="FontSize" Value="13" />
        <Setter Property="Margin" Value="0,0" />
        <Setter Property="Template">
          <ControlTemplate>
            <Panel>
              <Border Name="PART_LayoutRoot"
                      Background="{TemplateBinding Background}"
                      CornerRadius="{TemplateBinding CornerRadius}"
                      Padding="{TemplateBinding Padding}"
                      MinHeight="{TemplateBinding MinHeight}"
                      RenderTransformOrigin="0,0.5"
                      RenderTransform="translateX(0)">
                <Border.Transitions>
                  <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.1" />
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.12" Easing="CubicEaseOut" />
                  </Transitions>
                </Border.Transitions>
                <Grid ColumnDefinitions="Auto,*,Auto,Auto">

                  <!-- Icon column -->
                  <ContentPresenter Name="PART_IconPresenter"
                                    Content="{TemplateBinding Icon}"
                                    Width="16"
                                    Margin="0,0,6,0"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center"
                                    IsVisible="{TemplateBinding Icon, Converter={x:Static ObjectConverters.IsNotNull}}" />

                  <!-- Header text -->
                  <ContentPresenter Name="PART_HeaderPresenter"
                                    Grid.Column="1"
                                    Content="{TemplateBinding Header}"
                                    ContentTemplate="{TemplateBinding HeaderTemplate}"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Stretch"
                                    RecognizesAccessKey="True" />

                  <!-- Input gesture (keyboard shortcut) -->
                  <TextBlock Name="PART_InputGestureText"
                             Grid.Column="2"
                             Foreground="{DynamicResource Brush.TextTertiary}"
                             FontSize="12"
                             Margin="24,0,0,0"
                             VerticalAlignment="Center" />

                  <!-- Submenu chevron -->
                  <TextBlock Name="PART_ChevronPath"
                             Grid.Column="3"
                             Text="›"
                             FontSize="16"
                             Foreground="{DynamicResource Brush.TextTertiary}"
                             Margin="8,0,0,0"
                             VerticalAlignment="Center"
                             IsVisible="False" />
                </Grid>
              </Border>

              <!-- Submenu popup -->
              <Popup Name="PART_Popup"
                     WindowManagerAddShadowHint="False"
                     Placement="RightEdgeAlignedTop"
                     HorizontalOffset="-2"
                     IsLightDismissEnabled="False"
                     IsOpen="{TemplateBinding IsSubMenuOpen, Mode=TwoWay}"
                     strata:PopupAnimationHelper.EnableOverlayAnimation="True">
                <Border Background="{DynamicResource Brush.SurfaceOverlay}"
                        BorderBrush="{DynamicResource Brush.BorderDefault}"
                        BorderThickness="{DynamicResource Stroke.Thin}"
                        CornerRadius="{DynamicResource Radius.Interactive}"
                        Padding="4"
                        Margin="16"
                        MinWidth="180"
                        MaxWidth="320"
                        BoxShadow="0 16 48 -8 #30000000, 0 6 16 0 #18000000, 0 0 0 1 #0C000000">
                  <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                VerticalScrollBarVisibility="Auto"
                                MaxHeight="420">
                    <ItemsPresenter Name="PART_ItemsPresenter"
                                    ItemsPanel="{TemplateBinding ItemsPanel}" />
                  </ScrollViewer>
                </Border>
              </Popup>
            </Panel>
          </ControlTemplate>
        </Setter>

        <!-- Show chevron when item has submenu children -->
        <Style Selector="^:open /template/ TextBlock#PART_ChevronPath">
          <Setter Property="IsVisible" Value="True" />
        </Style>

        <!-- Hover -->
        <Style Selector="^:pointerover /template/ Border#PART_LayoutRoot">
          <Setter Property="Background" Value="{DynamicResource Brush.SubtleHover}" />
          <Setter Property="RenderTransform" Value="translateX(2px)" />
        </Style>

        <!-- Pressed -->
        <Style Selector="^:pressed /template/ Border#PART_LayoutRoot">
          <Setter Property="Background" Value="{DynamicResource Brush.SubtlePressed}" />
        </Style>

        <!-- Disabled -->
        <Style Selector="^:disabled">
          <Setter Property="Opacity" Value="0.45" />
        </Style>

        <!-- Focus visible -->
        <Style Selector="^:focus-visible /template/ Border#PART_LayoutRoot">
          <Setter Property="Background" Value="{DynamicResource Brush.SubtleHover}" />
        </Style>

        <!-- Selected (keyboard nav) -->
        <Style Selector="^:selected /template/ Border#PART_LayoutRoot">
          <Setter Property="Background" Value="{DynamicResource Brush.SubtleHover}" />
        </Style>
      </ControlTheme>

      <!-- ── Menu bar (top-level) – keep default template, apply tokens ── -->
      <ControlTheme x:Key="{x:Type Menu}" TargetType="Menu">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="FontFamily" Value="{DynamicResource Font.Family}" />
        <Setter Property="FontSize" Value="{DynamicResource Font.SizeBody}" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="Template">
          <ControlTemplate>
            <Border Background="{TemplateBinding Background}"
                    Padding="{TemplateBinding Padding}"
                    HorizontalAlignment="Stretch">
              <ItemsPresenter Name="PART_ItemsPresenter"
                              ItemsPanel="{TemplateBinding ItemsPanel}" />
            </Border>
          </ControlTemplate>
        </Setter>
      </ControlTheme>

    </ResourceDictionary>
  </Styles.Resources>

  <!-- ── ContextMenu Separator ── -->
  <Style Selector="ContextMenu Separator">
    <Setter Property="Height" Value="1" />
    <Setter Property="Background" Value="{DynamicResource Brush.BorderSubtle}" />
    <Setter Property="Margin" Value="6,3" />
  </Style>

  <!-- ── MenuFlyoutPresenter Separator ── -->
  <Style Selector="MenuFlyoutPresenter Separator">
    <Setter Property="Height" Value="1" />
    <Setter Property="Background" Value="{DynamicResource Brush.BorderSubtle}" />
    <Setter Property="Margin" Value="6,3" />
  </Style>

  <!-- ── Context-menu icon styling ── -->
  <Style Selector="ContextMenu MenuItem ContentPresenter#PART_IconPresenter TextBlock">
    <Setter Property="Foreground" Value="{DynamicResource Brush.TextSecondary}" />
    <Setter Property="TextAlignment" Value="Center" />
    <Setter Property="VerticalAlignment" Value="Center" />
  </Style>

  <!-- ── MenuFlyout icon styling ── -->
  <Style Selector="MenuFlyoutPresenter MenuItem ContentPresenter#PART_IconPresenter TextBlock">
    <Setter Property="Foreground" Value="{DynamicResource Brush.TextSecondary}" />
    <Setter Property="TextAlignment" Value="Center" />
    <Setter Property="VerticalAlignment" Value="Center" />
  </Style>

  <!-- ── No icon: collapse icon column so text starts flush ── -->
  <Style Selector="ContextMenu MenuItem ContentPresenter#PART_IconPresenter:empty">
    <Setter Property="Width" Value="0" />
    <Setter Property="Margin" Value="0" />
  </Style>

</Styles>
